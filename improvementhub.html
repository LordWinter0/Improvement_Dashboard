<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>90-Day Glow-Up Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8; /* Slightly adjusted background for a softer feel */
        }
        .nav-link {
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            padding-bottom: 0.75rem; /* Adjust for border */
        }
        .nav-link.active {
            color: #f59e0b;
            font-weight: 700; /* Bolder for active */
        }
        .nav-link.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 80%;
            height: 3px;
            background-color: #f59e0b;
            border-radius: 2px;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 400px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 350px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
            }
        }
        /* Hidden class for views and detail sections */
        .view.hidden, .detail-view.hidden {
            display: none;
        }
        .pillar-card, .skill-card, .shop-item-card {
            position: relative;
            overflow: hidden; /* Ensures content doesn't spill on toggle */
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out; /* Smooth transitions */
        }
        .pillar-card:hover, .skill-card:hover, .shop-item-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1); /* More pronounced hover shadow */
        }
        /* Icon styling (no longer toggling transform on card expanded state) */
        .view-detail-icon {
            font-size: 1.5rem;
            color: #f59e0b;
            transition: transform 0.3s ease;
            position: absolute; /* Position relative to the card */
            top: 1.5rem; /* Consistent with padding */
            right: 1.5rem; /* Consistent with padding */
            line-height: 1; /* Align vertically */
        }
        .progress-message {
            margin-top: 1rem;
            font-size: 1.125rem;
            font-weight: 500;
            color: #475569;
        }
        .skill-task, .pillar-task {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background-color: #fffbeb; /* Amber-50, slightly lighter */
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            margin-bottom: 0.5rem;
            border: 1px solid #fcd34d; /* Amber-300 border */
        }
        .skill-task.completed, .pillar-task.completed {
            background-color: #d1fae5; /* Green-100 */
            color: #065f46; /* Green-800 */
            text-decoration: line-through;
            border-color: #34d399; /* Green-400 border */
        }
        .skill-task-btn, .pillar-task-btn, .shop-buy-btn, .daily-quest-btn {
            padding: 0.25rem 0.75rem;
            font-size: 0.875rem;
            font-weight: 600;
            border-radius: 0.375rem;
            transition: all 0.2s ease;
            white-space: nowrap; /* Prevent button text from wrapping */
        }
        .skill-task-btn:not(:disabled), .pillar-task-btn:not(:disabled), .shop-buy-btn:not(:disabled), .daily-quest-btn:not(:disabled) {
            background-color: #fcd34d; /* Amber-300 */
            color: #78350f; /* Amber-900 */
            box-shadow: 0 2px 5px rgba(252, 211, 77, 0.3); /* Initial shadow */
        }
        .skill-task-btn:not(:disabled):hover, .pillar-task-btn:not(:disabled):hover, .shop-buy-btn:not(:disabled):hover, .daily-quest-btn:not(:disabled):hover {
            background-color: #fbbf24; /* Amber-400 */
            box-shadow: 0 4px 8px rgba(252, 211, 77, 0.5); /* More pronounced shadow on hover */
            transform: translateY(-1px);
        }
        .skill-task-btn:disabled, .pillar-task-btn:disabled, .shop-buy-btn:disabled, .daily-quest-btn:disabled {
            background-color: #a7f3d0; /* Green-200 */
            color: #065f46; /* Green-800 */
            cursor: not-allowed;
            box-shadow: none; /* No shadow when disabled */
        }

        /* Specific styles for card headers to ensure icon is within the clickable area */
        .pillar-card-header, .skill-card-header, .shop-item-header {
            display: flex;
            align-items: center;
            cursor: pointer; /* Changed to cursor: default for shop items that aren't expandable */
            padding-right: 3rem; /* Make space for the absolute icon */
            min-height: 48px; /* Ensure consistent height for header */
        }
        .pillar-card-header h4, .skill-card-header h4, .shop-item-header h4 {
            flex-grow: 1; /* Allow title to take available space */
        }
        .gradient-button {
            background-image: linear-gradient(to right, #f59e0b 0%, #fbbf24 100%);
            transition: all 0.3s ease;
        }
        .gradient-button:hover {
            background-position: right center; /* Change background position on hover */
            box-shadow: 0 5px 15px rgba(245, 158, 11, 0.4);
        }

        /* Personalization Menu Specific Styles */
        .personalization-form {
            background-color: white;
            padding: 2.5rem;
            border-radius: 1.5rem;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
            max-width: 600px;
            margin: 4rem auto;
            border: 1px solid #e2e8f0;
        }
        .personalization-form input[type="text"],
        .personalization-form select {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #cbd5e1;
            border-radius: 0.5rem;
            margin-top: 0.5rem;
            margin-bottom: 1.25rem;
            font-size: 1rem;
            color: #475569;
        }
        .personalization-form label {
            font-weight: 600;
            color: #334155;
            display: block;
            margin-bottom: 0.5rem;
        }
        .personalization-skills-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 0.75rem;
            margin-top: 1rem;
            margin-bottom: 1.5rem;
        }
        .personalization-skill-item {
            background-color: #fff;
            border: 1px solid #e2e8f0;
            border-radius: 0.75rem;
            padding: 0.75rem 1rem;
            display: flex;
            align-items: center;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }
        .personalization-skill-item:hover {
            border-color: #f59e0b;
            box-shadow: 0 2px 6px rgba(245, 158, 11, 0.2);
            transform: translateY(-2px);
        }
        .personalization-skill-item input[type="checkbox"] {
            margin-right: 0.75rem;
            min-width: 1.25rem;
            min-height: 1.25rem;
            accent-color: #f59e0b;
        }
        .personalization-skill-item.selected {
            background-color: #fffbeb; /* Light amber */
            border-color: #fbbf24; /* Amber-400 */
            box-shadow: 0 2px 6px rgba(245, 158, 11, 0.3);
        }
    </style>
</head>
<body class="text-slate-700">

    <div id="app" class="max-w-7xl mx-auto p-4 md:p-8">

        <!-- Personalization Menu - Displayed first if not personalized -->
        <section id="personalization-menu" class="view hidden">
            <div class="personalization-form">
                <h2 class="text-3xl font-bold text-slate-800 text-center mb-6">🌟 Personalize Your Glow-Up Journey 🌟</h2>
                <p class="text-slate-600 text-center mb-8">Tell us a little about yourself to tailor your experience!</p>

                <div class="mb-5">
                    <label for="user-name">Your Name:</label>
                    <input type="text" id="user-name" placeholder="E.g., Alex, Jamie" class="focus:ring-amber-500 focus:border-amber-500">
                </div>

                <div class="mb-6">
                    <label for="difficulty-select">Difficulty/Intensity:</label>
                    <select id="difficulty-select" class="focus:ring-amber-500 focus:border-amber-500">
                        <option value="casual">Casual (Relaxed pace)</option>
                        <option value="normal" selected>Normal (Steady progress)</option>
                        <option value="intense">Intense (Fast-paced growth)</option>
                    </select>
                </div>

                <div class="mb-6">
                    <label class="mb-3">Skills You Want to Develop:</label>
                    <div id="personalization-skills-grid" class="personalization-skills-grid">
                        <!-- Skills will be dynamically loaded here -->
                    </div>
                </div>

                <button id="start-glow-up-btn" class="w-full gradient-button text-white font-bold py-3 px-6 rounded-lg text-lg shadow-md hover:shadow-lg">Start Your Glow-Up!</button>
            </div>
        </section>

        <!-- Main App Content - Hidden initially -->
        <div id="app-main-content" class="hidden">
            <header class="text-center mb-10">
                <h1 class="text-4xl md:text-5xl font-bold text-slate-800">Hello, <span id="display-user-name"></span>!</h1>
                <p class="mt-2 text-lg text-slate-500">Your 90-Day Glow-Up: A complete guide to a more confident you.</p>
            </header>

            <nav class="flex justify-center border-b border-slate-200 mb-10 space-x-4 sm:space-x-8">
                <a data-view="dashboard" class="nav-link active py-4 px-2 sm:px-4 text-sm sm:text-base font-semibold text-slate-600 hover:text-amber-500">Dashboard</a>
                <a data-view="plan" class="nav-link py-4 px-2 sm:px-4 text-sm sm:text-base font-semibold text-slate-600 hover:text-amber-500">90-Day Plan</a>
                <a data-view="pillars" class="nav-link py-4 px-2 sm:px-4 text-sm sm:text-base font-semibold text-slate-600 hover:text-amber-500">The Pillars</a>
                <a data-view="skills" class="nav-link py-4 px-2 sm:px-4 text-sm sm:text-base font-semibold text-slate-600 hover:text-amber-500">Skills</a>
                <a data-view="daily-quest" class="nav-link py-4 px-2 sm:px-4 text-sm sm:text-base font-semibold text-slate-600 hover:text-amber-500">Daily Quest</a>
                <a data-view="shop" class="nav-link py-4 px-2 sm:px-4 text-sm sm:text-base font-semibold text-slate-600 hover:text-amber-500">Shop</a>
                <a data-view="schedule" class="nav-link py-4 px-2 sm:px-4 text-sm sm:text-base font-semibold text-slate-600 hover:text-amber-500">Daily Schedule</a>
            </nav>

            <main>
                <!-- Dashboard Section -->
                <section id="dashboard" class="view">
                    <div class="text-center mb-12">
                        <h2 class="text-3xl font-bold text-slate-700 mb-2">✨ Today's Focus ✨</h2>
                        <p class="text-slate-500">Consistency is your superpower. Let's make today count!</p>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                        <div class="md:col-span-2 bg-white p-6 rounded-2xl shadow-2xl border border-slate-100">
                            <div class="flex items-center mb-4">
                                <span id="today-pillar-icon" class="text-3xl mr-3"></span>
                                <h3 class="font-bold text-xl text-slate-800">Day <span id="today-day"></span> Mission</h3>
                            </div>
                            <p id="today-task" class="text-lg text-slate-600 leading-relaxed mb-6"></p>

                            <div class="bg-yellow-50 border border-yellow-200 p-4 rounded-lg mb-6 shadow-sm">
                                <h4 class="font-semibold text-amber-700 mb-2">Daily Tip:</h4>
                                <p id="daily-tip" class="text-amber-800 text-base italic">Loading a fresh tip for you...</p>
                            </div>
                            
                            <button id="complete-today-btn" class="w-full md:w-auto gradient-button text-white font-bold py-3 px-6 rounded-lg hover:bg-amber-600 transition-all duration-300 shadow-md">Mark as Complete</button>
                        </div>
                        <div class="bg-white p-6 rounded-2xl shadow-2xl border border-slate-100">
                            <h3 class="font-bold text-xl text-slate-800 mb-4">📊 Progress Tracker</h3>
                            <div class="chart-container">
                                <canvas id="progressChart"></canvas>
                            </div>
                            <p id="progress-message" class="progress-message text-center"></p>
                        </div>
                    </div>
                </section>

                <!-- 90-Day Plan Section -->
                <section id="plan" class="view hidden">
                    <div class="text-center mb-8">
                        <h2 class="text-3xl font-bold text-slate-700 mb-2">Your 90-Day Calendar</h2>
                        <p class="text-slate-500">Click on any day to see your mission. Today is highlighted for you!</p>
                    </div>
                    <div id="calendar-grid" class="grid grid-cols-3 sm:grid-cols-5 md:grid-cols-7 gap-4">
                    </div>
                </section>

                <!-- Pillars Main Grid Section -->
                <section id="pillars" class="view hidden">
                    <div class="text-center mb-8">
                        <h2 class="text-3xl font-bold text-slate-700 mb-2">The Six Pillars of Your Glow-Up</h2>
                        <p class="text-slate-500">These are the core principles behind your daily actions. Click each one to learn more.</p>
                    </div>
                    <div id="pillars-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <!-- Pillar cards will be rendered here by JS -->
                    </div>
                </section>

                <!-- Pillar Detail View Section (Hidden by default) -->
                <section id="pillar-detail-view" class="detail-view hidden p-4 bg-white rounded-2xl shadow-2xl border border-slate-100 max-w-4xl mx-auto">
                    <button id="back-to-pillars-btn" class="text-amber-500 hover:text-amber-600 font-semibold mb-6 flex items-center">
                        <span class="text-xl mr-2">←</span> Back to Pillars
                    </button>
                    <div class="flex items-center mb-4">
                        <span id="pillar-detail-icon" class="text-4xl mr-4"></span>
                        <h3 id="pillar-detail-title" class="font-bold text-2xl text-slate-800"></h3>
                    </div>
                    <p id="pillar-detail-content" class="text-slate-600 mb-6 leading-relaxed"></p>

                    <h4 class="font-semibold text-xl text-slate-700 mb-3">Actionable Steps:</h4>
                    <div id="pillar-detail-tasks" class="space-y-2 mb-6">
                        <!-- Pillar tasks will be rendered here by JS -->
                    </div>
                    <p class="mt-4 text-sm font-medium text-slate-600">Progress: <span id="pillar-progress-text" class="font-bold text-amber-600">0%</span> of tasks completed for this pillar.</p>
                    <div class="w-full bg-slate-200 rounded-full h-2.5 mt-2">
                        <div id="pillar-progress-bar" class="bg-amber-500 h-2.5 rounded-full" style="width: 0%"></div>
                    </div>
                </section>


                <!-- Skills Main Grid Section -->
                <section id="skills" class="view hidden">
                    <div class="text-center mb-8">
                        <h2 class="text-3xl font-bold text-slate-700 mb-2">Level Up Your Skills!</h2>
                        <p class="text-slate-500">Explore new interests and develop valuable abilities. Click each skill area to get started!</p>
                    </div>
                    <div id="skills-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <!-- Skill cards will be rendered here by JS -->
                    </div>
                </section>

                <!-- Skill Detail View Section (Hidden by default) -->
                <section id="skill-detail-view" class="detail-view hidden p-4 bg-white rounded-2xl shadow-2xl border border-slate-100 max-w-4xl mx-auto">
                    <button id="back-to-skills-btn" class="text-amber-500 hover:text-amber-600 font-semibold mb-6 flex items-center">
                        <span class="text-xl mr-2">←</span> Back to Skills
                    </button>
                    <div class="flex items-center mb-4">
                        <span id="skill-detail-icon" class="text-4xl mr-4"></span>
                        <h3 id="skill-detail-title" class="font-bold text-2xl text-slate-800"></h3>
                    </div>
                    <p id="skill-detail-content" class="text-slate-600 mb-6 leading-relaxed"></p>

                    <h4 class="font-semibold text-xl text-slate-700 mb-3">Practice Tasks:</h4>
                    <div id="skill-detail-tasks" class="space-y-2 mb-6">
                        <!-- Skill tasks will be rendered here by JS -->
                    </div>
                    <p class="mt-4 text-sm font-medium text-slate-600">Progress: <span id="skill-progress-text" class="font-bold text-amber-600">0%</span> of tasks completed for this skill.</p>
                    <div class="w-full bg-slate-200 rounded-full h-2.5 mt-2">
                        <div id="skill-progress-bar" class="bg-amber-500 h-2.5 rounded-full" style="width: 0%"></div>
                    </div>
                </section>

                <!-- Daily Quest Section -->
                <section id="daily-quest" class="view hidden">
                    <div class="text-center mb-8">
                        <h2 class="text-3xl font-bold text-slate-700 mb-2">🎯 Daily Quest 🎯</h2>
                        <p class="text-slate-500">Complete this optional quest for extra Glow Tokens!</p>
                        <p class="text-lg font-semibold mt-4 text-slate-700">Your Glow Tokens: <span id="tokens-display" class="text-amber-500">0</span> ✨</p>
                    </div>
                    <div class="bg-white p-6 rounded-2xl shadow-2xl border border-slate-100 max-w-2xl mx-auto">
                        <div class="flex items-center mb-4">
                            <span id="quest-icon" class="text-3xl mr-3">❓</span>
                            <h3 class="font-bold text-xl text-slate-800">Today's Special Quest:</h3>
                        </div>
                        <p id="daily-quest-text" class="text-lg text-slate-600 leading-relaxed mb-6">Loading your quest...</p>
                        <button id="complete-daily-quest-btn" class="w-full gradient-button text-white font-bold py-3 px-6 rounded-lg shadow-md">Mark Quest Complete</button>
                    </div>
                </section>

                <!-- Shop Section -->
                <section id="shop" class="view hidden">
                    <div class="text-center mb-8">
                        <h2 class="text-3xl font-bold text-slate-700 mb-2">🛍️ The Glow-Up Shop 🛍️</h2>
                        <p class="text-slate-500">Spend your hard-earned Glow Tokens!</p>
                        <p class="text-lg font-semibold mt-4 text-slate-700">Your Glow Tokens: <span id="shop-tokens-display" class="text-amber-500">0</span> ✨</p>
                    </div>
                    <div id="shop-items-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 max-w-4xl mx-auto">
                        <!-- Shop items will be rendered here by JS -->
                    </div>
                </section>

                <!-- Daily Schedule Section -->
                <section id="schedule" class="view hidden">
                    <div class="text-center mb-8">
                        <h2 class="text-3xl font-bold text-slate-700 mb-2">Your Daily Blueprint</h2>
                        <p class="text-slate-500">A template for success. Use this to structure your days.</p>
                    </div>
                    <div class="flex justify-center mb-6">
                        <button id="weekday-btn" class="schedule-btn bg-amber-500 text-white py-2 px-6 rounded-l-lg font-semibold shadow-md hover:shadow-lg transition-shadow">Weekday</button>
                        <button id="weekend-btn" class="schedule-btn bg-slate-200 text-slate-600 py-2 px-6 rounded-r-lg font-semibold shadow-md hover:shadow-lg transition-shadow">Weekend</button>
                    </div>
                    <div id="schedule-content" class="bg-white p-6 sm:p-8 rounded-2xl shadow-xl border border-slate-100 max-w-4xl mx-auto">
                    </div>
                </section>
            </main>
        </div> <!-- End of app-main-content -->
    </div>

    <!-- Modals (Task Modal and Message Box) -->
    <div id="task-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full border border-slate-200">
            <h3 class="font-bold text-2xl text-slate-800 mb-4">Day <span id="modal-day"></span> Mission</h3>
            <p id="modal-task" class="text-slate-600 mb-6"></p>
            <button id="close-modal-btn" class="w-full bg-slate-200 text-slate-700 font-bold py-2 px-4 rounded-lg hover:bg-slate-300 transition-colors shadow-sm">Close</button>
        </div>
    </div>
    
    <div id="message-box" class="fixed bottom-5 right-5 bg-green-500 text-white py-3 px-5 rounded-lg shadow-xl transform translate-y-20 opacity-0 transition-all duration-500 z-50">
        Task marked as complete!
    </div>

    <script>
        const TOTAL_CHALLENGE_DAYS = 90;
        const TOKEN_FOR_DAILY_QUEST = 3; // Tokens gained per daily quest

        const AppState = {
            currentView: 'dashboard',
            userName: null, // New: User's name
            difficulty: 'normal', // New: User's chosen difficulty
            selectedSkills: new Set(), // New: Skills picked by the user
            isPersonalized: false, // New: Flag to check if personalization is done
            today: 1,
            completedDays: new Set(),
            completedSkillTasks: {},
            completedPillarTasks: {},
            tokens: 0, // New: User's tokens
            dailyQuestCompletedToday: false, // New: Whether today's daily quest is done
            lastDailyQuestDate: null, // New: Date when last daily quest was generated/completed
            restDaysAvailable: 0, // New: Count of rest days purchased
            startDate: null,
            lastVisitDate: null
        };

        const dailyTasks = Array.from({ length: TOTAL_CHALLENGE_DAYS }, (_, i) => {
            const day = i + 1;
            let pillar, task;

            if (day <= 30) {
                switch (day % 10) {
                    case 1: pillar = 'Mind'; task = "Goal Setting & Hydration: Write down your goals. Track water intake."; break;
                    case 2: pillar = 'Skin'; task = "Simple Cleansing: Gentle face wash morning and night."; break;
                    case 3: pillar = 'Body'; task = "Mindful Movement: 20-minute walk or in-place exercise."; break;
                    case 4: pillar = 'Mind'; task = "Study Space Overhaul: Organize your desk and study area."; break;
                    case 5: pillar = 'Nourish'; task = "Fruit Focus: Try a new fruit as a snack."; break;
                    case 6: pillar = 'Nourish'; task = "Healthy Swap: Swap one sugary drink for water."; break;
                    case 7: pillar = 'Mind'; task = "Reflection & Relaxation: Review your week. Listen to music or read."; break;
                    case 8: pillar = 'Body'; task = "Workout Fun: 15-minute dance workout."; break;
                    case 9: pillar = 'Mind'; task = "Active Learning: Summarize a chapter in your own words."; break;
                    case 0: pillar = 'Body'; task = "Strength Starter: 2 sets of 10 squats, 20-second plank."; break;
                    default: pillar = 'Mind'; task = "Daily check-in: How are you feeling today?"; break;
                }
                if (day === 11) { pillar = 'Hygiene'; task = "Hygiene Refresh: Clean toothbrush. Wear fresh clothes."; }
                if (day === 12) { pillar = 'Style'; task = "Style Fun: Try a new, simple hairstyle."; }
                if (day === 13) { pillar = 'Nourish'; task = "Snack Smart: Choose fruit over chips/candy."; }
                if (day === 14) { pillar = 'Mind'; task = "Mid-Point Check-in: Notice any changes? Pat yourself on the back!"; }
                if (day === 15) { pillar = 'Nourish'; task = "Breakfast Boost: Start with a banana or fruit."; }
                if (day === 16) { pillar = 'Mind'; task = "Brain Boost: 20 minutes reading for fun."; }
                if (day === 17) { pillar = 'Body'; task = "Cardio Challenge: 3 sets of 30 jumping jacks."; }
                if (day === 18) { pillar = 'Style'; task = "Closet Cleanse: Organize favorite outfits."; }
                if (day === 19) { pillar = 'Mind'; task = "Gratitude Practice: Think of one good thing today."; }
                if (day === 20) { pillar = 'Skin'; task = "Self-Care Simple: Relaxing bath/shower, gentle skin scrub."; }
                if (day === 21) { pillar = 'Body'; task = "Outdoor Time: 15 minutes outside (not midday sun)."; }
                if (day === 22) { pillar = 'Nourish'; task = "Kitchen Helper: Help with family meal prep."; }
                if (day === 23) { pillar = 'Mind'; task = "Focus Power: Try Pomodoro Technique for homework."; }
                if (day === 24) { pillar = 'Body'; task = "Full-Body Flow: 20-min routine: jumping jacks, squats, push-ups, plank."; }
                if (day === 25) { pillar = 'Hygiene'; task = "Scent-sational Self-Care: Daily deodorant. Baby powder for freshness."; }
                if (day === 26) { pillar = 'Style'; task = "Outfit of the Day: Pick your favorite clean outfit, wear with confidence."; }
                if (day === 27) { pillar = 'Mind'; task = "Mindful Morning: 5 minutes quiet stretching."; }
                if (day === 28) { pillar = 'Mind'; task = "Knowledge is Power: Watch an interesting educational video."; }
                if (day === 29) { pillar = 'Style'; task = "Confidence Boost: Stand straight, shoulders back, smile in mirror."; }
                if (day === 30) { pillar = 'Mind'; task = "Celebrate You! Look back at Day 1. Be proud of your consistency!"; }
            } else if (day <= 60) {
                switch (day % 10) {
                    case 1: pillar = 'Nourish'; task = "Balanced Meal: Include a protein, veggie, and carb in one meal."; break;
                    case 2: pillar = 'Body'; task = "Core Strength: Try 3 sets of 15 crunches."; break;
                    case 3: pillar = 'Skin'; task = "Exfoliation Intro: Gently exfoliate face (once this week)."; break;
                    case 4: pillar = 'Hygiene'; task = "Oral Care: Add mouthwash to your routine."; break;
                    case 5: pillar = 'Mind'; task = "Journaling: Write 3 things you're grateful for."; break;
                    case 6: pillar = 'Style'; task = "Color Pop: Wear an item with a color you love."; break;
                    case 7: pillar = 'Nourish'; task = "Hydration Challenge: Drink an extra glass of water."; break;
                    case 8: pillar = 'Body'; task = "Active Chores: Help with active chores like sweeping or gardening for 20 min."; break;
                    case 9: pillar = 'Mind'; task = "New Skill Mini-Lesson: Watch a short tutorial on something new (e.g., drawing, simple coding)."; break;
                    case 0: pillar = 'Skin'; task = "Moisturize! Apply moisturizer after washing your face."; break;
                    default: pillar = 'Mind'; task = "Discover a new educational podcast or channel."; break;
                }
                if (day === 35) { pillar = 'Mind'; task = "Mindful Breathing: Practice 5 minutes of deep breathing exercises."; }
                if (day === 45) { pillar = 'Body'; task = "Flexibility Focus: Spend 10 minutes stretching your major muscle groups."; }
                if (day === 50) { pillar = 'Nourish'; task = "Healthy Snack Prep: Prepare some healthy snacks for the next few days."; }
                if (day === 55) { pillar = 'Style'; task = "Accessories Experiment: Try adding a simple accessory like a watch or a bracelet."; }
                if (day === 59) { pillar = 'Mind'; task = "Future Planning: Jot down some ideas for after the 90-day challenge."; }
                if (day === 60) { pillar = 'Mind'; task = "60-Day Review: Reflect on progress, celebrate consistency. You're doing great!"; }

            } else {
                switch (day % 10) {
                    case 1: pillar = 'Nourish'; task = "Cook a Simple Dish: Help prepare a main dish for your family."; break;
                    case 2: pillar = 'Body'; task = "Incorporate Stairs: Take the stairs instead of the elevator/escalator today."; break;
                    case 3: pillar = 'Skin'; task = "Sun Protection Awareness: Learn about SPF and why it's important."; break;
                    case 4: pillar = 'Hygiene'; task = "Laundry Day: Help with laundry, especially your own clothes."; break;
                    case 5: pillar = 'Mind'; task = "Digital Detox: Spend 1 hour away from screens before bed."; break;
                    case 6: pillar = 'Style'; task = "Outfit Planning: Plan outfits for the entire week ahead."; break;
                    case 7: pillar = 'Body'; task = "Interval Training: Try short bursts of high-intensity activity during your walk."; break;
                    case 8: pillar = 'Nourish'; task = "Smoothie Experiment: Create your own healthy smoothie recipe."; break;
                    case 9: pillar = 'Mind'; task = "Problem Solving: Tackle a challenging puzzle or brain teaser."; break;
                    case 0: pillar = 'Hygiene'; task = "Clean Your Space: Dedicate 30 minutes to tidying your room."; break;
                    default: pillar = 'Mind'; task = "Read an article or watch a documentary on a topic you're curious about."; break;
                }
                if (day === 75) { pillar = 'Mind'; task = "Goal Refinement: Revisit your initial goals. How have they evolved?"; }
                if (day === 80) { pillar = 'Body'; task = "Challenge Yourself: Try a longer workout or a new physical activity."; }
                if (day === 85) { pillar = 'Skin'; task = "Identify Skin Type: Do a simple test to understand your skin type (oily, dry, combo)."; }
                if (day === 89) { pillar = 'Mind'; task = "Vision Board: Create a small vision board for your future self."; }
                if (day === 90) { pillar = 'Mind'; task = "Final Celebration! You've completed 90 days! Acknowledge your incredible transformation and plan for continued growth!"; }
            }
            return { day, pillar, task };
        });

        const pillarsData = [
            {
                id: 'nourish', icon: '🍎', title: 'Nourish Your Body', content: "Fuel your body for energy and health. Focus on fruits (2-3 servings daily), 'hidden' veggies in dishes like lumpia or spaghetti sauce, and drink 6-8 glasses of water. A smoothie with banana and malunggay is a great nutrient boost.",
                tasks: [
                    "Drink 8 glasses of water today.",
                    "Eat at least 2 servings of fruit.",
                    "Include a vegetable in your lunch and dinner.",
                    "Try a new healthy vegetable or fruit you haven't eaten before.",
                    "Swap one sugary drink for water or unsweetened tea.",
                    "Help prepare a healthy meal for your family.",
                    "Identify one 'hidden' vegetable you can add to a common dish.",
                    "Plan your snacks for tomorrow to be healthy options.",
                    "Avoid processed snacks for one day.",
                    "Read food labels to identify added sugars in one item."
                ]
            },
            {
                id: 'body', icon: '💪', title: 'Move Your Body', content: "Get stronger and boost your mood without a gym. Aim for 30 minutes of movement 5 days a week. Combine 15-20 mins of cardio (dancing, jumping jacks) with 10-15 mins of strength (squats, planks, push-ups).",
                tasks: [
                    "Go for a 20-minute brisk walk.",
                    "Do 3 sets of 10 squats.",
                    "Hold a plank for 30 seconds (or accumulate 30 seconds with breaks).",
                    "Do 3 sets of 15 jumping jacks.",
                    "Try a 15-minute dance workout from YouTube.",
                    "Help with an active chore for 20 minutes (e.g., sweeping, gardening).",
                    "Stretch for 10 minutes before or after your movement session.",
                    "Take the stairs instead of an elevator/escalator today.",
                    "Do 3 sets of 5 push-ups (on knees if needed).",
                    "Explore a new type of home exercise (e.g., yoga, calisthenics)."
                ]
            },
            {
                id: 'skin', icon: '✨', title: 'Radiant Skin', content: "Achieve clean, healthy skin with a simple routine. Your #1 priority is cleansing your face gently with mild soap and water every morning and night. For sun protection, seek shade, wear a cap, or use an umbrella, especially from 10 AM to 4 PM.",
                tasks: [
                    "Wash your face gently morning and night.",
                    "Apply a simple moisturizer after washing your face.",
                    "Drink an extra glass of water to support skin hydration.",
                    "Wear a cap or use an umbrella when outside in the sun.",
                    "Avoid touching your face unnecessarily throughout the day.",
                    "Gently pat your face dry instead of rubbing after washing.",
                    "Identify your skin type (e.g., oily, dry, combination) with a simple observation.",
                    "Change your pillowcase today for cleaner sleep.",
                    "Learn about the importance of SPF (Sun Protection Factor).",
                    "Ensure you're removing all makeup before bed."
                ]
            },
            {
                id: 'hygiene', icon: '💧', title: 'Impeccable Hygiene', content: "Feel and smell fresh all day. Key habits include daily showers (especially after exercise), brushing your teeth twice a day, using deodorant every morning, and wearing completely fresh, clean clothes every day.",
                tasks: [
                    "Take a refreshing shower/bath today.",
                    "Brush your teeth for 2 minutes, twice today.",
                    "Apply deodorant/antiperspirant in the morning.",
                    "Wear clean, fresh clothes today.",
                    "Floss your teeth once today.",
                    "Clean your toothbrush and its holder.",
                    "Use mouthwash after brushing your teeth.",
                    "Trim your nails if needed.",
                    "Help with laundry, focusing on your own clothes.",
                    "Ensure your shoes are clean and odor-free."
                ]
            },
            {
                id: 'mind', icon: '🧠', title: 'Sharpen Your Mind', content: "Make learning more effective. Keep a dedicated, organized study space. Use the Pomodoro Technique (25 mins focus, 5 mins break) to avoid burnout. Review your notes for 15 minutes each evening to retain information.",
                tasks: [
                    "Organize your study space for 15 minutes.",
                    "Use the Pomodoro Technique (25 min focus, 5 min break) for a study session.",
                    "Spend 15 minutes reviewing notes from a challenging subject.",
                    "Read a non-fiction article or a chapter from a book for 20 minutes.",
                    "Practice mindfulness with 5 minutes of deep breathing.",
                    "Write down 3 things you are grateful for today.",
                    "Watch an educational video or documentary for 30 minutes.",
                    "Solve a challenging puzzle or brain teaser.",
                    "Learn 5 new words and their meanings.",
                    "Reflect on your day for 10 minutes before bed."
                ]
            },
            {
                id: 'style', icon: '👕', title: 'Cultivate Your Style', content: "Express yourself and feel confident. Use Pinterest for inspiration. Master the basics like well-fitting jeans and clean t-shirts. A simple outfit looks great with neat hair and good posture. Pick out your clothes the night before.",
                tasks: [
                    "Choose an outfit for tomorrow tonight.",
                    "Ensure your hair is neat and styled.",
                    "Practice good posture for 5 minutes in front of a mirror.",
                    "Iron or steam one of your favorite shirts.",
                    "Identify 3 items in your wardrobe that fit well.",
                    "Create a small mood board (digital or physical) of styles you like.",
                    "Learn a new, simple hairstyle or way to tie a scarf.",
                    "Accessorize your outfit with one simple item (e.g., watch, simple necklace).",
                    "Organize a small section of your closet.",
                    "Take a photo of an outfit you feel confident in."
                ]
            }
        ];

        const skillsData = [
            {
                id: 'coding', icon: '💻', title: 'Coding & Digital', content: 'Learn the fundamentals of coding and digital literacy. Start with visual programming and gradually move to text-based languages.', tasks: [
                    "Complete a 'Hello World' tutorial in Scratch or Python.",
                    "Learn and use 3 basic HTML tags (e.g., `<p>`, `<h1>`, `<a>`).",
                    "Understand how to save and open a simple text file on your computer.",
                    "Practice basic touch typing for 15 minutes using an online tool.",
                    "Watch a short (10-15 min) video on internet safety and privacy.",
                    "Attempt a simple coding challenge, like making a variable count to 10.",
                    "Create a very basic webpage with your name and favorite color.",
                    "Learn about common keyboard shortcuts for copying, pasting, and undoing.",
                    "Explore a coding game or puzzle website (e.g., Code.org, Lightbot) for 20 minutes.",
                    "Understand what an algorithm is with a real-world example (e.g., making a sandwich).",
                    "Identify the main components of a computer (e.g., CPU, RAM, storage).",
                    "Learn to use a simple online calculator for basic operations.",
                    "Explore how to safely download and install a free program.",
                    "Understand what a 'browser' is and how it works.",
                    "Set up a simple online account with a strong password."
                ]
            },
            {
                id: 'creative-arts', icon: '🎨', title: 'Creative Arts', content: 'Unleash your creativity through various artistic expressions. No prior experience needed!', tasks: [
                    "Draw 5 simple shapes from observation (e.g., a cup, a book, a phone).",
                    "Listen actively to a new music genre for 15 minutes, noting instruments or feelings.",
                    "Write a short paragraph (5-7 sentences) describing your favorite place or a recent dream.",
                    "Experiment with drawing using only circles and squares to create an object.",
                    "Learn 3 basic chords on a guitar, ukulele, or keyboard (if available).",
                    "Try a simple origami fold from an online tutorial, aiming for neatness.",
                    "Sketch a self-portrait (it doesn't have to be perfect, just practice!).",
                    "Create a small collage using old magazines, newspapers, or printed images.",
                    "Listen to a piece of classical music and try to identify at least two different instruments.",
                    "Write a short, rhyming poem (4-6 lines) about nature or your daily routine.",
                    "Try a simple drawing prompt from an online generator (e.g., 'a smiling cloud').",
                    "Hum or sing a simple melody you just made up.",
                    "Describe a piece of art or music to a friend or family member.",
                    "Find an interesting pattern in your surroundings and sketch it.",
                    "Learn about a famous artist or musician you admire."
                ]
            },
            {
                id: 'singing', icon: '🎤', title: 'Singing', content: 'Develop your vocal abilities and confidence. Learn basic techniques and practice regularly.', tasks: [
                    "Practice a simple vocal warm-up for 5 minutes.",
                    "Sing along to your favorite song, focusing on rhythm.",
                    "Try to match the pitch of a simple note played on an instrument or app.",
                    "Record yourself singing a short phrase and listen back.",
                    "Learn about proper breathing techniques for singing.",
                    "Sing a simple scale (do-re-mi) a few times.",
                    "Listen to a song and try to identify the lead melody.",
                    "Sing a lullaby or a nursery rhyme.",
                    "Experiment with singing in different vocal tones (e.g., softer, louder).",
                    "Watch a short online tutorial on basic singing posture."
                ]
            },
            {
                id: 'songwriting', icon: '✍️🎶', title: 'Songwriting', content: 'Explore expressing your thoughts and feelings through lyrics and melodies.', tasks: [
                    "Write down 5 emotions you felt today.",
                    "Brainstorm 10 rhyming words for 'moon'.",
                    "Write a short, descriptive paragraph about a place you love.",
                    "Try to create a simple 4-line poem about an everyday object.",
                    "Listen to a song and identify its main theme.",
                    "Think of a simple story you could tell in a song.",
                    "Hum a simple, new melody for 30 seconds.",
                    "Combine two unrelated words to spark a creative idea (e.g., 'tree' + 'ocean').",
                    "Write down 3 lines that could be the start of a song chorus.",
                    "Experiment with different tempos for a simple melody (faster, slower)."
                ]
            },
            {
                id: 'writing', icon: '📝', title: 'Writing (General)', content: 'Improve your communication and storytelling skills through various forms of writing.', tasks: [
                    "Write a journal entry about your day (at least 100 words).",
                    "Practice writing a descriptive paragraph about your favorite food.",
                    "Write a short thank-you note to someone.",
                    "Summarize a short article or video in 3-5 sentences.",
                    "Brainstorm 10 ideas for a short story.",
                    "Write a review of a movie or book you recently experienced.",
                    "Experiment with different opening sentences for a story.",
                    "Write a letter to your future self.",
                    "Practice using more vivid adjectives in your writing.",
                    "Read a short story or poem and identify its main message."
                ]
            },
            {
                id: 'digital-art', icon: '📱🎨', title: 'Digital Art', content: 'Explore creating art using digital tools and software.', tasks: [
                    "Experiment with a free online drawing tool (e.g., Google Canvas).",
                    "Learn how to create a basic shape (circle, square) in a digital program.",
                    "Draw a simple doodle using a drawing app on your phone/tablet.",
                    "Learn about layers in digital art (if your tool has them).",
                    "Try coloring a simple digital line art piece.",
                    "Watch a short tutorial on basic digital painting techniques.",
                    "Create a simple pattern using copy-paste in a digital program.",
                    "Experiment with different brush types or colors in a digital art app.",
                    "Learn how to save your digital artwork in a common format (e.g., JPG, PNG).",
                    "Attempt to digitally trace a simple photograph."
                ]
            },
            {
                id: 'photography', icon: '📸', title: 'Photography', content: 'Learn to capture beautiful moments and tell stories with your camera (even a phone camera!).', tasks: [
                    "Take 5 photos of everyday objects from different angles.",
                    "Learn about the 'rule of thirds' in photography.",
                    "Take a photo focusing on natural light (e.g., sunlight through a window).",
                    "Experiment with taking close-up photos (macro photography).",
                    "Take a photo of a landscape or an interesting outdoor scene.",
                    "Learn about leading lines in composition.",
                    "Take a portrait of a friend or family member (with their permission).",
                    "Experiment with taking photos during 'golden hour' (sunrise/sunset).",
                    "Learn about positive and negative space in a photograph.",
                    "Take a photo that tells a small story without words."
                ]
            },
            {
                id: 'public-speaking', icon: '🗣️', title: 'Public Speaking', content: 'Build confidence and clarity in expressing your thoughts to an audience.', tasks: [
                    "Practice speaking clearly for 2 minutes about your favorite hobby.",
                    "Record yourself talking and listen back to identify areas for improvement.",
                    "Practice making eye contact with yourself in a mirror while speaking.",
                    "Learn 3 tips for reducing public speaking anxiety.",
                    "Deliver a short, prepared speech to a family member.",
                    "Practice vocal exercises to improve articulation.",
                    "Observe a confident speaker and note their mannerisms.",
                    "Try to explain a complex topic in simple terms to someone else.",
                    "Learn about the importance of pauses in speaking.",
                    "Practice deep breathing exercises before speaking."
                ]
            },
            {
                id: 'leadership', icon: '🤝', title: 'Leadership', content: 'Develop skills to guide, inspire, and motivate others effectively.', tasks: [
                    "Identify a task and take initiative to complete it without being asked.",
                    "Offer to help a friend or family member with a task they're struggling with.",
                    "Practice active listening when someone is speaking to you.",
                    "Learn about the qualities of a good leader (e.g., empathy, decisiveness).",
                    "Help organize a small group activity or game.",
                    "Encourage someone else in their efforts or achievements.",
                    "Take responsibility for a mistake you made.",
                    "Practice giving clear and concise instructions.",
                    "Learn about the importance of teamwork.",
                    "Identify a problem in your environment and brainstorm solutions."
                ]
            },
            {
                id: 'entrepreneurship', icon: '💡💰', title: 'Entrepreneurship', content: 'Explore the world of business, innovation, and creating value.', tasks: [
                    "Brainstorm 3 simple product or service ideas you could offer.",
                    "Research a local small business you admire and why it's successful.",
                    "Learn about the concept of 'supply and demand'.",
                    "Identify a problem in your community and think of a business solution.",
                    "Create a simple 'business plan' for a lemonade stand.",
                    "Learn about different ways businesses make money.",
                    "Practice negotiating a price (e.g., for a chore reward).",
                    "Read a short story or watch a video about a famous entrepreneur.",
                    "Understand what a 'customer' is and why they're important.",
                    "Think about what makes a product appealing to people."
                ]
            },
            {
                id: 'problem-solving', icon: '🤔', title: 'Problem Solving', content: 'Enhance your ability to analyze situations and find effective solutions.', tasks: [
                    "Identify a small problem you face today and brainstorm 3 solutions.",
                    "Solve a logic puzzle or riddle.",
                    "Break down a complex task into smaller, manageable steps.",
                    "Learn about the '5 Whys' technique for root cause analysis.",
                    "Think of an alternative use for an everyday object.",
                    "Analyze a scenario from a book or movie and suggest better outcomes.",
                    "Practice creative thinking by connecting two unrelated ideas.",
                    "When faced with a challenge, list its pros and cons.",
                    "Seek out a new perspective on a familiar issue.",
                    "Play a strategy game (e.g., chess, checkers) and analyze your moves."
                ]
            },
            {
                id: 'critical-thinking', icon: '🧐', title: 'Critical Thinking', content: 'Develop skills to evaluate information, form reasoned judgments, and make informed decisions.', tasks: [
                    "Read a news headline and think of 2 questions to ask about it.",
                    "Identify the main argument in a short article or debate.",
                    "Learn about the difference between fact and opinion.",
                    "When presented with information, ask 'Why?' or 'How do I know this is true?'.",
                    "Evaluate a product advertisement: what are they trying to convince you of?",
                    "Consider a decision you made today: what factors influenced it?",
                    "Practice identifying biases in statements or media.",
                    "Discuss a complex topic with someone who has a different viewpoint.",
                    "Learn about logical fallacies (e.g., ad hominem, straw man) briefly.",
                    "Formulate your own reasoned opinion on a simple topic."
                ]
            },
            {
                id: 'emotional-intelligence', icon: '❤️‍🩹', title: 'Emotional Intelligence', content: 'Understand and manage your own emotions, and recognize and influence the emotions of others.', tasks: [
                    "Identify 3 emotions you felt today and why you felt them.",
                    "Practice active listening when a friend is sharing a problem.",
                    "Learn about body language cues (e.g., crossed arms, smiling).",
                    "Try to understand someone else's perspective on a disagreement.",
                    "Practice expressing your feelings clearly and respectfully.",
                    "Identify a trigger for a strong emotion you feel (e.g., frustration).",
                    "Learn about empathy and how it helps relationships.",
                    "Offer genuine encouragement to someone who needs it.",
                    "Reflect on how your mood affects your actions.",
                    "Learn a simple technique for calming yourself when stressed (e.g., deep breaths)."
                ]
            },
            {
                id: 'diy-home-repair', icon: '🔧', title: 'DIY & Home Repair', content: 'Gain basic practical skills for maintaining and fixing things around the house.', tasks: [
                    "Learn how to use a screwdriver (Phillips and Flathead).",
                    "Identify the main water shut-off valve in your home.",
                    "Learn how to change a lightbulb safely.",
                    "Help tighten a loose screw on a piece of furniture.",
                    "Identify 3 common tools in a basic toolbox.",
                    "Learn how to safely plug in and unplug electrical devices.",
                    "Help organize a small utility drawer or area.",
                    "Learn how to use a measuring tape accurately.",
                    "Identify the circuit breaker box in your home.",
                    "Practice using a hammer to tap a nail into a scrap piece of wood."
                ]
            },
            {
                id: 'basic-car-maintenance', icon: '🚗', title: 'Basic Car Maintenance', content: 'Understand the basics of vehicle care and safety.', tasks: [
                    "Locate the windshield wiper fluid reservoir in a car.",
                    "Learn how to check tire pressure (if a gauge is available).",
                    "Identify the car's gas tank cap and how to open it.",
                    "Learn about the importance of changing oil regularly.",
                    "Locate the car's headlights and turn signals.",
                    "Understand what warning lights on a dashboard might mean (briefly).",
                    "Learn how to properly clean a car's interior.",
                    "Identify where the car's spare tire is stored (if applicable).",
                    "Learn how to check the oil level with a dipstick (with adult supervision).",
                    "Understand the importance of safe driving habits."
                ]
            },
            {
                id: 'cooking-baking', icon: '🍳', title: 'Cooking & Baking', content: 'Develop culinary skills to prepare delicious and healthy meals and treats.', tasks: [
                    "Safely chop an onion (with adult supervision).",
                    "Make a simple sandwich from scratch.",
                    "Learn to boil water and cook pasta correctly.",
                    "Bake simple cookies following a recipe exactly.",
                    "Identify 5 common kitchen utensils and their uses.",
                    "Help prepare one component of a family meal (e.g., chop veggies).",
                    "Learn about food safety basics (e.g., washing hands).",
                    "Make a simple salad with at least 3 ingredients.",
                    "Learn how to measure dry and liquid ingredients accurately.",
                    "Experiment with a simple spice or herb in a dish."
                ]
            },
            {
                id: 'gardening', icon: '🌱', title: 'Gardening', content: 'Cultivate a green thumb and learn about plant care and growth.', tasks: [
                    "Water a plant and observe how the water is absorbed.",
                    "Identify 3 common plants or trees in your neighborhood.",
                    "Learn about the basic needs of a plant (sunlight, water, soil).",
                    "Help plant a seed or a small plant.",
                    "Learn how to gently remove weeds from a garden bed.",
                    "Observe an insect in the garden and identify it.",
                    "Learn about composting in simple terms.",
                    "Help prune a small branch or dead leaf from a plant.",
                    "Research a plant that grows well in your local climate.",
                    "Start a small indoor herb garden with just one herb."
                ]
            },
            {
                id: 'fitness-nutrition', icon: '🏋️‍♀️🥦', title: 'Fitness & Nutrition', content: 'Deepen your understanding of exercise science and healthy eating for optimal well-being.', tasks: [
                    "Research the benefits of protein for muscle growth.",
                    "Plan a balanced meal with appropriate portions of carbs, protein, and fats.",
                    "Learn about different types of cardio exercises (e.g., HIIT, steady-state).",
                    "Understand the concept of 'macronutrients' (protein, carbs, fats).",
                    "Perform a dynamic warm-up routine for 10 minutes.",
                    "Research the importance of stretching for flexibility.",
                    "Identify 3 healthy snack alternatives to processed foods.",
                    "Learn about the recommended daily water intake for your age.",
                    "Try a new healthy recipe that incorporates a leafy green vegetable.",
                    "Research the recommended amount of sleep for your age group."
                ]
            }
        ];


        const shopItems = [
            {
                id: 'rest-day',
                name: 'Rest Day',
                icon: '🛌',
                description: 'Skip one daily mission! The day will be marked as complete without doing the task.',
                cost: 10
            },
            {
                id: 'tip-boost',
                name: 'Daily Tip Boost',
                icon: '💡',
                description: 'Get an extra, immediate motivational tip for today!',
                cost: 5
            }
        ];

        const schedulesData = {
            weekday: `
                <h4 class="font-bold text-lg mb-4 text-slate-700">Weekday Schedule</h4>
                <ul class="space-y-3 text-slate-600">
                    <li><strong>5:30-6:00 AM:</strong> Wake Up & Hydrate, Stretch, Wash Face, Brush Teeth.</li>
                    <li><strong>6:00-6:30 AM:</strong> Shower, Deodorant, Get Dressed, Fix Hair.</li>
                    <li><strong>6:30-7:00 AM:</strong> Healthy Breakfast, Pack Bag, Fill Water Bottle.</li>
                    <li><strong>7:00 AM-3:00 PM:</strong> School Time (Participate, stay hydrated).</li>
                    <li><strong>3:00-4:00 PM:</strong> Arrive Home, Healthy Snack, Rest (no gadgets).</li>
                    <li><strong>4:00-5:00 PM:</strong> Glow-Up Hour (Workout + Daily Mission).</li>
                    <li><strong>5:00-6:30 PM:</strong> Homework & Study.</li>
                    <li><strong>6:30-8:00 PM:</strong> Dinner & Family Time.</li>
                    <li><strong>8:00-9:00 PM:</strong> Wind Down (Review notes, pick clothes, read, relax).</li>
                    <li><strong>9:00-9:30 PM:</strong> Final Prep for Bed (No screens, wash face, brush teeth).</li>
                </ul>
            `,
            weekend: `
                <h4 class="font-bold text-lg mb-4 text-slate-700">Weekend Schedule</h4>
                <ul class="space-y-3 text-slate-600">
                    <li><strong>Morning (8 AM-12 PM):</strong> Wake up, Hydrate, Breakfast, Hygiene Routine, Glow-Up Hour (Workout + Mission).</li>
                    <li><strong>Afternoon (12 PM-5 PM):</strong> Lunch, Household Chores, 1-hour School Review/Project Work, Free Time/Hobbies.</li>
                    <li><strong>Evening (5 PM onwards):</strong> Relax, Dinner, Family Time.</li>
                    <li class="pt-2 font-semibold text-amber-600"><strong>Sunday Night:</strong> Do your "Wind Down" routine to prepare for Monday!</li>
                </ul>
            `
        };
        
        let progressChartInstance = null;
        
        function updateView(viewName) {
            // Hide all main views
            document.querySelectorAll('.view').forEach(view => view.classList.add('hidden'));
            // Hide all detail views
            document.querySelectorAll('.detail-view').forEach(detailView => detailView.classList.add('hidden'));

            // Show the requested main view
            document.getElementById(viewName).classList.remove('hidden');

            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
                if (link.dataset.view === viewName) {
                    link.classList.add('active');
                }
            });
            AppState.currentView = viewName;

            // Specific renders for new sections when they become active
            if (viewName === 'daily-quest') {
                renderDailyQuest();
            } else if (viewName === 'shop') {
                renderShop();
            }
        }

        async function renderDashboard() {
            const currentChallengeDay = AppState.today > TOTAL_CHALLENGE_DAYS ? TOTAL_CHALLENGE_DAYS : AppState.today;
            
            const taskForToday = dailyTasks.find(t => t.day === currentChallengeDay) || dailyTasks[dailyTasks.length - 1];
            
            document.getElementById('today-day').textContent = currentChallengeDay;
            document.getElementById('today-task').textContent = taskForToday.task;

            // Update user name in header
            document.getElementById('display-user-name').textContent = AppState.userName || 'Glow-Upper';

            // Find the icon for today's pillar
            const todayPillar = pillarsData.find(p => p.title.includes(taskForToday.pillar)); // Adjusted to match 'pillar' in dailyTasks to 'title' in pillarsData
            document.getElementById('today-pillar-icon').textContent = todayPillar ? todayPillar.icon : '✨';


            const completeBtn = document.getElementById('complete-today-btn');
            if (AppState.completedDays.has(currentChallengeDay)) {
                completeBtn.textContent = 'Completed!';
                completeBtn.disabled = true;
                completeBtn.classList.remove('gradient-button', 'hover:bg-amber-600');
                completeBtn.classList.add('bg-green-500', 'hover:bg-green-500');
            } else if (AppState.restDaysAvailable > 0) {
                // If rest days are available, show an option to use one
                completeBtn.textContent = `Mark as Complete (Use Rest Day: ${AppState.restDaysAvailable})`;
                completeBtn.disabled = false;
                completeBtn.classList.remove('bg-green-500', 'hover:bg-green-500');
                completeBtn.classList.add('gradient-button', 'hover:bg-amber-600');
            }
            else {
                completeBtn.textContent = 'Mark as Complete';
                completeBtn.disabled = false;
                completeBtn.classList.remove('bg-green-500', 'hover:bg-green-500');
                completeBtn.classList.add('gradient-button', 'hover:bg-amber-600');
            }

            // Fetch and display daily tip
            await fetchDailyTip(taskForToday.pillar);

            renderProgressChart();
        }

        async function fetchDailyTip(pillarName, targetElementId = 'daily-tip') {
            const tipElement = document.getElementById(targetElementId);
            const originalText = tipElement.textContent; // Store original text for message box
            tipElement.textContent = 'Loading a fresh tip for you...'; // Loading state

            // Prioritize selected skills for tips if available
            let promptContext = '';
            if (AppState.selectedSkills.size > 0) {
                const skillsArray = Array.from(AppState.selectedSkills).map(id => skillsData.find(s => s.id === id)?.title || id);
                promptContext = `Focus on one of these skills if relevant: ${skillsArray.join(', ')}.`;
            }

            let chatHistory = [];
            chatHistory.push({ role: "user", parts: [{ text: `Provide a very short (max 2 sentences) motivational tip or quote for the '${pillarName}' pillar of self-improvement. ${promptContext} Make it inspiring and action-oriented.` }] });
            const payload = { contents: chatHistory };
            const apiKey = ""; 
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                const result = await response.json();
                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const text = result.candidates[0].content.parts[0].text;
                    tipElement.textContent = text;
                } else {
                    tipElement.textContent = originalText; // Revert to original if failed
                    console.error('LLM response structure unexpected:', result);
                }
            } catch (error) {
                tipElement.textContent = originalText; // Revert to original if failed
                console.error('Error fetching daily tip:', error);
            }
        }


        function renderCalendar() {
            const grid = document.getElementById('calendar-grid');
            grid.innerHTML = '';
            dailyTasks.forEach(task => {
                const dayEl = document.createElement('div');
                dayEl.dataset.day = task.day;
                dayEl.className = 'day-cell h-20 sm:h-24 flex items-center justify-center font-bold text-xl rounded-lg cursor-pointer transition-all duration-300';
                dayEl.textContent = task.day;
                
                let baseClasses = 'bg-white shadow-md hover:shadow-xl hover:-translate-y-1 border border-slate-100';
                
                if (AppState.completedDays.has(task.day)) {
                    baseClasses = 'bg-green-100 text-green-700 shadow-sm border border-green-200';
                }
                
                if (task.day === AppState.today) {
                    baseClasses += ' ring-2 ring-amber-500 ring-offset-2'; /* Added ring-offset for better highlight */
                }
                
                dayEl.classList.add(...baseClasses.split(' '));
                
                grid.appendChild(dayEl);
            });
        }
        
        function renderPillars() {
            const grid = document.getElementById('pillars-grid');
            grid.innerHTML = '';
            pillarsData.forEach(pillar => {
                grid.innerHTML += `
                    <div class="pillar-card bg-white p-6 rounded-2xl shadow-lg cursor-pointer border border-slate-100" data-pillar-id="${pillar.id}">
                        <div class="pillar-card-header">
                            <span class="text-3xl mr-4">${pillar.icon}</span>
                            <h4 class="font-bold text-xl text-slate-800">${pillar.title}</h4>
                        </div>
                        <span class="view-detail-icon">→</span>
                    </div>
                `;
            });
            document.querySelectorAll('.pillar-card').forEach(card => {
                card.addEventListener('click', () => {
                    const pillarId = card.dataset.pillarId;
                    showPillarDetail(pillarId);
                });
            });
        }

        function showPillarDetail(pillarId) {
            const pillar = pillarsData.find(p => p.id === pillarId);
            if (!pillar) return;

            // Hide main pillars view and show detail view
            document.getElementById('pillars').classList.add('hidden');
            const detailView = document.getElementById('pillar-detail-view');
            detailView.classList.remove('hidden');

            // Populate detail view
            document.getElementById('pillar-detail-icon').textContent = pillar.icon;
            document.getElementById('pillar-detail-title').textContent = pillar.title;
            document.getElementById('pillar-detail-content').textContent = pillar.content;

            const tasksContainer = document.getElementById('pillar-detail-tasks');
            tasksContainer.innerHTML = '';
            
            const completedTasks = AppState.completedPillarTasks[pillar.id] || [];

            pillar.tasks.forEach((taskText, index) => {
                const isCompleted = completedTasks.includes(index);
                tasksContainer.innerHTML += `
                    <div class="pillar-task ${isCompleted ? 'completed' : ''}">
                        <span class="text-slate-700 ${isCompleted ? 'text-green-800' : ''}">${taskText}</span>
                        <button data-pillar-id="${pillar.id}" data-task-index="${index}" class="pillar-task-btn" ${isCompleted ? 'disabled' : ''}>
                            ${isCompleted ? 'Done' : 'Mark Done'}
                        </button>
                    </div>
                `;
            });

            // Update progress
            const progress = pillar.tasks.length > 0 ? Math.round((completedTasks.length / pillar.tasks.length) * 100) : 0;
            document.getElementById('pillar-progress-text').textContent = `${progress}%`;
            document.getElementById('pillar-progress-bar').style.width = `${progress}%`;

            // Add event listeners for new buttons (delegated for efficiency)
            tasksContainer.querySelectorAll('.pillar-task-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    const clickedPillarId = e.target.dataset.pillarId;
                    const taskIndex = parseInt(e.target.dataset.taskIndex);

                    if (!AppState.completedPillarTasks[clickedPillarId]) {
                        AppState.completedPillarTasks[clickedPillarId] = [];
                    }

                    if (!AppState.completedPillarTasks[clickedPillarId].includes(taskIndex)) {
                        AppState.completedPillarTasks[clickedPillarId].push(taskIndex);
                        saveState();
                        // Re-render only the current pillar detail view to update progress and button state
                        showPillarDetail(clickedPillarId); 
                        showMessage(`Task completed for ${clickedPillarId}!`);
                    } else {
                        showMessage('Task already completed!');
                    }
                });
            });
        }

        function renderSkills() {
            const grid = document.getElementById('skills-grid');
            grid.innerHTML = '';
            skillsData.forEach(skill => {
                grid.innerHTML += `
                    <div class="skill-card bg-white p-6 rounded-2xl shadow-lg cursor-pointer border border-slate-100" data-skill-id="${skill.id}">
                        <div class="skill-card-header">
                            <span class="text-3xl mr-4">${skill.icon}</span>
                            <h4 class="font-bold text-xl text-slate-800">${skill.title}</h4>
                        </div>
                        <span class="view-detail-icon">→</span>
                    </div>
                `;
            });

            document.querySelectorAll('.skill-card').forEach(card => {
                card.addEventListener('click', () => {
                    const skillId = card.dataset.skillId;
                    showSkillDetail(skillId);
                });
            });
        }

        function showSkillDetail(skillId) {
            const skill = skillsData.find(s => s.id === skillId);
            if (!skill) return;

            // Hide main skills view and show detail view
            document.getElementById('skills').classList.add('hidden');
            const detailView = document.getElementById('skill-detail-view');
            detailView.classList.remove('hidden');

            // Populate detail view
            document.getElementById('skill-detail-icon').textContent = skill.icon;
            document.getElementById('skill-detail-title').textContent = skill.title;
            document.getElementById('skill-detail-content').textContent = skill.content;

            const tasksContainer = document.getElementById('skill-detail-tasks');
            tasksContainer.innerHTML = '';
            
            const completedTasks = AppState.completedSkillTasks[skill.id] || [];

            skill.tasks.forEach((taskText, index) => {
                const isCompleted = completedTasks.includes(index);
                tasksContainer.innerHTML += `
                    <div class="skill-task ${isCompleted ? 'completed' : ''}">
                        <span class="text-slate-700 ${isCompleted ? 'text-green-800' : ''}">${taskText}</span>
                        <button data-skill-id="${skill.id}" data-task-index="${index}" class="skill-task-btn" ${isCompleted ? 'disabled' : ''}>
                            ${isCompleted ? 'Done' : 'Mark Done'}
                        </button>
                    </div>
                `;
            });

            // Update progress
            const progress = skill.tasks.length > 0 ? Math.round((completedTasks.length / skill.tasks.length) * 100) : 0;
            document.getElementById('skill-progress-text').textContent = `${progress}%`;
            document.getElementById('skill-progress-bar').style.width = `${progress}%`;

            // Add event listeners for new buttons (delegated for efficiency)
            tasksContainer.querySelectorAll('.skill-task-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    const clickedSkillId = e.target.dataset.skillId;
                    const taskIndex = parseInt(e.target.dataset.taskIndex);

                    if (!AppState.completedSkillTasks[clickedSkillId]) {
                        AppState.completedSkillTasks[clickedSkillId] = [];
                    }

                    if (!AppState.completedSkillTasks[clickedSkillId].includes(taskIndex)) {
                        AppState.completedSkillTasks[clickedSkillId].push(taskIndex);
                        saveState();
                        // Re-render only the current skill detail view to update progress and button state
                        showSkillDetail(clickedSkillId);
                        showMessage(`Task completed for ${clickedSkillId}!`);
                    } else {
                        showMessage('Task already completed!');
                    }
                });
            });
        }

        async function renderDailyQuest() {
            const todayFormatted = formatDate(new Date());
            const questTextElement = document.getElementById('daily-quest-text');
            const questBtn = document.getElementById('complete-daily-quest-btn');
            const tokensDisplay = document.getElementById('tokens-display');

            tokensDisplay.textContent = AppState.tokens;

            // Check if a new quest needs to be generated (or if it's a new day)
            if (AppState.lastDailyQuestDate !== todayFormatted) {
                AppState.dailyQuestCompletedToday = false;
                AppState.lastDailyQuestDate = todayFormatted;
                saveState(); // Save the new quest date immediately
            }

            if (AppState.dailyQuestCompletedToday) {
                questTextElement.textContent = "You've already completed today's quest! Come back tomorrow for a new challenge. �";
                questBtn.disabled = true;
                questBtn.classList.remove('gradient-button');
                questBtn.classList.add('bg-green-500', 'hover:bg-green-500');
            } else {
                questBtn.disabled = false;
                questBtn.classList.remove('bg-green-500', 'hover:bg-green-500');
                questBtn.classList.add('gradient-button');

                questTextElement.textContent = 'Generating a fun quest for you...';
                
                let promptTarget = '';
                if (AppState.selectedSkills.size > 0) {
                    // Pick a random selected skill to focus the quest on
                    const selectedSkillIds = Array.from(AppState.selectedSkills);
                    const randomSkillId = selectedSkillIds[Math.floor(Math.random() * selectedSkillIds.length)];
                    const selectedSkillTitle = skillsData.find(s => s.id === randomSkillId)?.title;
                    promptTarget = `related to the skill '${selectedSkillTitle}'`;
                } else {
                    // Fallback to a random pillar if no skills selected
                    promptTarget = `related to the '${pillarsData[Math.floor(Math.random() * pillarsData.length)].title}' pillar`;
                }


                let chatHistory = [];
                chatHistory.push({ role: "user", parts: [{ text: `Generate a single, very short (max 2 sentences), fun, and actionable daily quest ${promptTarget} for a self-improvement app. Make it lighthearted and easy to understand.` }] });
                const payload = { contents: chatHistory };
                const apiKey = ""; 
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    const result = await response.json();
                    if (result.candidates && result.candidates.length > 0 &&
                        result.candidates[0].content && result.candidates[0].content.parts &&
                        result.candidates[0].content.parts.length > 0) {
                        const questText = result.candidates[0].content.parts[0].text;
                        document.getElementById('daily-quest-text').textContent = questText;
                    } else {
                        document.getElementById('daily-quest-text').textContent = 'Failed to load quest. Try again!';
                        console.error('LLM response structure unexpected:', result);
                    }
                } catch (error) {
                    document.getElementById('daily-quest-text').textContent = 'Network error fetching quest. Check your connection.';
                    console.error('Error fetching daily quest:', error);
                }
            }
        }

        function completeDailyQuest() {
            if (!AppState.dailyQuestCompletedToday) {
                AppState.tokens += TOKEN_FOR_DAILY_QUEST;
                AppState.dailyQuestCompletedToday = true;
                saveState();
                renderDailyQuest(); // Re-render to update status and tokens
                showMessage(`Quest complete! You earned ${TOKEN_FOR_DAILY_QUEST} Glow Tokens! ✨`);
            } else {
                showMessage("You've already completed today's quest!");
            }
        }

        function renderShop() {
            const shopItemsGrid = document.getElementById('shop-items-grid');
            shopItemsGrid.innerHTML = '';
            document.getElementById('shop-tokens-display').textContent = AppState.tokens;

            shopItems.forEach(item => {
                const canAfford = AppState.tokens >= item.cost;
                shopItemsGrid.innerHTML += `
                    <div class="shop-item-card bg-white p-6 rounded-2xl shadow-lg border border-slate-100 ${canAfford ? 'hover:shadow-xl hover:-translate-y-1' : ''}">
                        <div class="shop-item-header mb-3">
                            <span class="text-3xl mr-4">${item.icon}</span>
                            <h4 class="font-bold text-xl text-slate-800">${item.name}</h4>
                        </div>
                        <p class="text-slate-600 mb-4">${item.description}</p>
                        <div class="flex items-center justify-between">
                            <span class="font-bold text-lg text-amber-600">${item.cost} ✨</span>
                            <button data-item-id="${item.id}" class="shop-buy-btn py-2 px-4 ${canAfford ? 'gradient-button' : 'bg-gray-300 text-gray-500'}" ${!canAfford ? 'disabled' : ''}>
                                ${canAfford ? 'Buy' : 'Can\'t Afford'}
                            </button>
                        </div>
                    </div>
                `;
            });

            document.querySelectorAll('.shop-buy-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    const itemId = e.target.dataset.itemId;
                    buyShopItem(itemId);
                });
            });
        }

        function buyShopItem(itemId) {
            const item = shopItems.find(i => i.id === itemId);
            if (!item) return;

            if (AppState.tokens >= item.cost) {
                AppState.tokens -= item.cost;
                saveState(); // Deduct tokens first

                switch (itemId) {
                    case 'rest-day':
                        AppState.restDaysAvailable++;
                        showMessage(`Successfully purchased a Rest Day! You now have ${AppState.restDaysAvailable} rest days.`);
                        break;
                    case 'tip-boost':
                        showMessage('Here is your extra daily tip!');
                        // Trigger a new daily tip fetch, possibly from a random selected skill if available
                        let randomPillarForTip = pillarsData[Math.floor(Math.random() * pillarsData.length)].title;
                        if (AppState.selectedSkills.size > 0) {
                            const selectedSkillIds = Array.from(AppState.selectedSkills);
                            const randomSkillId = selectedSkillIds[Math.floor(Math.random() * selectedSkillIds.length)];
                            randomPillarForTip = skillsData.find(s => s.id === randomSkillId)?.title || randomPillarForTip;
                        }
                        fetchDailyTip(randomPillarForTip, 'message-box'); 
                        break;
                    default:
                        showMessage('Unknown item purchased.');
                }
                renderShop(); // Re-render shop to update token count and button states
                renderDashboard(); // Re-render dashboard if rest day count changes
            } else {
                showMessage(`Not enough tokens! You need ${item.cost} tokens for this.`);
            }
        }
        
        function renderSchedule(type = 'weekday') {
            document.getElementById('schedule-content').innerHTML = schedulesData[type];
            const weekdayBtn = document.getElementById('weekday-btn');
            const weekendBtn = document.getElementById('weekend-btn');

            if (type === 'weekday') {
                weekdayBtn.classList.add('bg-amber-500', 'text-white', 'shadow-md');
                weekdayBtn.classList.remove('bg-slate-200', 'text-slate-600');
                weekendBtn.classList.add('bg-slate-200', 'text-slate-600');
                weekendBtn.classList.remove('bg-amber-500', 'text-white', 'shadow-md');
            } else {
                weekendBtn.classList.add('bg-amber-500', 'text-white', 'shadow-md');
                weekendBtn.classList.remove('bg-slate-200', 'text-slate-600');
                weekdayBtn.classList.add('bg-slate-200', 'text-slate-600');
                weekdayBtn.classList.remove('bg-amber-500', 'text-white', 'shadow-md');
            }
        }

        function renderProgressChart() {
            const ctx = document.getElementById('progressChart').getContext('2d');
            const completedCount = AppState.completedDays.size;
            const totalDays = TOTAL_CHALLENGE_DAYS;
            const remainingCount = totalDays - completedCount;

            const data = {
                labels: ['Completed', 'Remaining'],
                datasets: [{
                    data: [completedCount, remainingCount],
                    backgroundColor: [
                        '#10b981', // Green-500
                        '#cbd5e1'  // Slate-300 for remaining
                    ],
                    borderColor: '#f0f4f8', /* Match body background */
                    borderWidth: 4,
                    hoverOffset: 4
                }]
            };

            let progressMessage = '';
            if (completedCount === totalDays) {
                progressMessage = "🎉 Challenge Completed! You're amazing!";
            } else if (completedCount >= totalDays / 2) {
                progressMessage = `Halfway there! Keep glowing! (${completedCount}/${totalDays})`;
            } else if (completedCount > 0) {
                progressMessage = `You're on your way! (${completedCount}/${totalDays})`;
            } else {
                progressMessage = `Start your journey today! (${completedCount}/${totalDays})`;
            }
            document.getElementById('progress-message').textContent = progressMessage;

            const chartTitle = `${completedCount} of ${totalDays} Days Complete`;

            if(progressChartInstance) {
                progressChartInstance.data.datasets[0].data = [completedCount, remainingCount];
                progressChartInstance.options.plugins.title.text = chartTitle;
                progressChartInstance.update();
            } else {
                progressChartInstance = new Chart(ctx, {
                    type: 'doughnut',
                    data: data,
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        cutout: '70%',
                        plugins: {
                            legend: {
                                display: false
                            },
                            tooltip: {
                                enabled: true
                            },
                            title: {
                                display: true,
                                text: chartTitle,
                                font: {
                                    size: 18, /* Slightly larger title */
                                    weight: 'bold'
                                },
                                color: '#334155'
                            }
                        }
                    }
                });
            }
        }
        
        function showModalForDay(dayNumber) {
            const task = dailyTasks.find(t => t.day == dayNumber);
            if(task) {
                document.getElementById('modal-day').textContent = task.day;
                document.getElementById('modal-task').textContent = task.task;
                document.getElementById('task-modal').classList.remove('hidden');
            }
        }
        
        function showMessage(text) {
            const msgBox = document.getElementById('message-box');
            msgBox.textContent = text;
            msgBox.classList.remove('opacity-0', 'translate-y-20');
            setTimeout(() => {
                msgBox.classList.add('opacity-0', 'translate-y-20');
            }, 3000);
        }

        function formatDate(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        function loadState() {
            const savedState = localStorage.getItem('glowUpAppState');
            if (savedState) {
                const parsedState = JSON.parse(savedState);
                AppState.completedDays = new Set(parsedState.completedDays || []);
                AppState.completedSkillTasks = parsedState.completedSkillTasks || {};
                AppState.completedPillarTasks = parsedState.completedPillarTasks || {};
                AppState.tokens = parsedState.tokens || 0;
                AppState.dailyQuestCompletedToday = parsedState.dailyQuestCompletedToday || false;
                AppState.lastDailyQuestDate = parsedState.lastDailyQuestDate || null;
                AppState.restDaysAvailable = parsedState.restDaysAvailable || 0;
                
                // Load personalization data
                AppState.userName = parsedState.userName || null;
                AppState.difficulty = parsedState.difficulty || 'normal';
                AppState.selectedSkills = new Set(parsedState.selectedSkills || []);
                AppState.isPersonalized = parsedState.isPersonalized || false;

                AppState.startDate = parsedState.startDate ? new Date(parsedState.startDate) : null;
                AppState.lastVisitDate = parsedState.lastVisitDate || null;
            }

            const todayActual = new Date();
            todayActual.setHours(0, 0, 0, 0);
            const todayFormatted = formatDate(todayActual);

            if (!AppState.startDate) {
                AppState.startDate = new Date(todayActual);
                AppState.lastVisitDate = todayFormatted;
                saveState();
            }

            const diffTime = Math.abs(todayActual.getTime() - AppState.startDate.getTime());
            const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));

            AppState.today = diffDays + 1;

            if (AppState.lastVisitDate !== todayFormatted) {
                AppState.lastVisitDate = todayFormatted;
                saveState();
            }
        }

        function saveState() {
            const stateToSave = {
                completedDays: Array.from(AppState.completedDays),
                completedSkillTasks: AppState.completedSkillTasks,
                completedPillarTasks: AppState.completedPillarTasks,
                tokens: AppState.tokens,
                dailyQuestCompletedToday: AppState.dailyQuestCompletedToday,
                lastDailyQuestDate: AppState.lastDailyQuestDate,
                restDaysAvailable: AppState.restDaysAvailable,
                // Save personalization data
                userName: AppState.userName,
                difficulty: AppState.difficulty,
                selectedSkills: Array.from(AppState.selectedSkills), // Convert Set to Array for saving
                isPersonalized: AppState.isPersonalized,

                startDate: AppState.startDate ? formatDate(AppState.startDate) : null,
                lastVisitDate: AppState.lastVisitDate
            };
            localStorage.setItem('glowUpAppState', JSON.stringify(stateToSave));
        }

        function renderPersonalizationMenu() {
            const skillsGrid = document.getElementById('personalization-skills-grid');
            skillsGrid.innerHTML = '';
            skillsData.forEach(skill => {
                const isSelected = AppState.selectedSkills.has(skill.id);
                skillsGrid.innerHTML += `
                    <label class="personalization-skill-item ${isSelected ? 'selected' : ''}">
                        <input type="checkbox" data-skill-id="${skill.id}" ${isSelected ? 'checked' : ''}>
                        <span class="text-2xl mr-2">${skill.icon}</span>
                        <span class="font-medium text-slate-700">${skill.title}</span>
                    </label>
                `;
            });

            // Set initial values from AppState if already present (e.g., after loading state but before personalization is complete)
            document.getElementById('user-name').value = AppState.userName || '';
            document.getElementById('difficulty-select').value = AppState.difficulty;

            // Add event listeners for checkboxes to toggle 'selected' class
            skillsGrid.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
                checkbox.addEventListener('change', (e) => {
                    const label = e.target.closest('label');
                    if (e.target.checked) {
                        label.classList.add('selected');
                    } else {
                        label.classList.remove('selected');
                    }
                });
            });
        }


        document.addEventListener('DOMContentLoaded', () => {
            loadState();
            
            // Check if personalization is complete
            if (!AppState.isPersonalized) {
                document.getElementById('personalization-menu').classList.remove('hidden');
                document.getElementById('app-main-content').classList.add('hidden');
                renderPersonalizationMenu(); // Render skills checkboxes
            } else {
                document.getElementById('personalization-menu').classList.add('hidden');
                document.getElementById('app-main-content').classList.remove('hidden');
                // Initial renders for the main app
                renderDashboard();
                renderCalendar();
                renderPillars();
                renderSkills();
                renderSchedule('weekday');
                renderShop();
            }

            // Event listener for "Start Your Glow-Up!" button
            document.getElementById('start-glow-up-btn').addEventListener('click', () => {
                const userNameInput = document.getElementById('user-name').value.trim();
                if (!userNameInput) {
                    showMessage('Please enter your name to start your glow-up!');
                    return;
                }
                AppState.userName = userNameInput;
                AppState.difficulty = document.getElementById('difficulty-select').value;
                
                // Collect selected skills
                AppState.selectedSkills.clear();
                document.querySelectorAll('#personalization-skills-grid input[type="checkbox"]:checked').forEach(checkbox => {
                    AppState.selectedSkills.add(checkbox.dataset.skillId);
                });

                AppState.isPersonalized = true;
                saveState();

                document.getElementById('personalization-menu').classList.add('hidden');
                document.getElementById('app-main-content').classList.remove('hidden');
                
                // Re-render all main sections with personalized data
                renderDashboard();
                renderCalendar();
                renderPillars();
                renderSkills();
                renderSchedule('weekday');
                renderShop();
                showMessage(`Welcome, ${AppState.userName}! Let's glow up! ✨`);
            });

            document.querySelector('nav').addEventListener('click', (e) => {
                if (e.target.matches('.nav-link')) {
                    const viewName = e.target.dataset.view;
                    updateView(viewName);
                }
            });

            document.getElementById('calendar-grid').addEventListener('click', (e) => {
                const dayCell = e.target.closest('.day-cell');
                if (dayCell) {
                    showModalForDay(dayCell.dataset.day);
                }
            });
            
            document.getElementById('close-modal-btn').addEventListener('click', () => {
                document.getElementById('task-modal').classList.add('hidden');
            });
            document.getElementById('task-modal').addEventListener('click', (e) => {
                if (e.target.id === 'task-modal') {
                    document.getElementById('task-modal').classList.add('hidden');
                }
            });

            // Back buttons for detail views
            document.getElementById('back-to-pillars-btn').addEventListener('click', () => {
                document.getElementById('pillar-detail-view').classList.add('hidden');
                document.getElementById('pillars').classList.remove('hidden');
            });
            document.getElementById('back-to-skills-btn').addEventListener('click', () => {
                document.getElementById('skill-detail-view').classList.add('hidden');
                document.getElementById('skills').classList.remove('hidden');
            });

            // Daily Quest completion handler
            document.getElementById('complete-daily-quest-btn').addEventListener('click', completeDailyQuest);


            document.getElementById('weekday-btn').addEventListener('click', () => renderSchedule('weekday'));
            document.getElementById('weekend-btn').addEventListener('click', () => renderSchedule('weekend'));

            document.getElementById('complete-today-btn').addEventListener('click', () => {
                const currentChallengeDay = AppState.today;

                if (currentChallengeDay > TOTAL_CHALLENGE_DAYS) {
                    showMessage(`All ${TOTAL_CHALLENGE_DAYS} days are complete! You are amazing!`);
                    return;
                }

                if (AppState.completedDays.has(currentChallengeDay)) {
                    showMessage('You' + "'" + 've already completed today' + "'" + 's mission!');
                    return;
                }

                if (AppState.restDaysAvailable > 0) {
                    // Use a rest day to complete the mission
                    AppState.completedDays.add(currentChallengeDay);
                    AppState.restDaysAvailable--;
                    saveState();
                    renderDashboard(); // Re-render to update completed status and rest day count
                    renderCalendar();
                    showMessage('Used a Rest Day! Mission completed without effort. 🎉');
                } else {
                    // Mark as complete normally
                    AppState.completedDays.add(currentChallengeDay);
                    saveState();
                    renderDashboard(); // Re-render to update completed status
                    renderCalendar();
                    showMessage('Great job! Mission complete!');
                }
            });
        });
    </script>

</body>
</html>
