<!DOCTYPE html>
<html lang="en" data-theme="light"> <!-- Data-theme attribute for theme switching -->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Improvement Hub Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* CSS Variables for Theming */
        :root {
            --bg-primary: #f0f4f8; --bg-secondary: #ffffff; --bg-accent: #fffbeb;
            --text-primary: #1f2937; --text-secondary: #4b5563; --text-accent: #78350f;
            --border-primary: #e5e7eb; --border-accent: #fcd34d;
            --brand-primary: #f59e0b; --brand-secondary: #fbbf24;
            --shadow-color: rgba(0,0,0,0.1);
        }
        [data-theme="dark"] {
            --bg-primary: #111827; --bg-secondary: #1f2937; --bg-accent: #374151;
            --text-primary: #f9fafb; --text-secondary: #d1d5db; --text-accent: #fcd34d;
            --border-primary: #374151; --border-accent: #f59e0b;
            --brand-primary: #f59e0b; --brand-secondary: #fbbf24;
            --shadow-color: rgba(0,0,0,0.2);
        }
        [data-theme="synthwave"] {
            --bg-primary: #2d1b47; --bg-secondary: #1e1533; --bg-accent: #4a2a67;
            --text-primary: #f1c40f; --text-secondary: #9b59b6; --text-accent: #ffffff;
            --border-primary: #4a2a67; --border-accent: #ff7ac6;
            --brand-primary: #ff7ac6; --brand-secondary: #00e5ff;
            --shadow-color: rgba(0,0,0,0.25);
        }
        [data-theme="forest"] {
            --bg-primary: #1a2e29; --bg-secondary: #243831; --bg-accent: #3c5a4f;
            --text-primary: #a7f3d0; --text-secondary: #6ee7b7; --text-accent: #ffffff;
            --border-primary: #3c5a4f; --border-accent: #34d399;
            --brand-primary: #34d399; --brand-secondary: #a7f3d0;
            --shadow-color: rgba(0,0,0,0.25);
        }
        [data-theme="ocean"] {
            --bg-primary: #0c2a4d; --bg-secondary: #1a3a5d; --bg-accent: #2a5a8d;
            --text-primary: #93c5fd; --text-secondary: #60a5fa; --text-accent: #ffffff;
            --border-primary: #2a5a8d; --border-accent: #3b82f6;
            --brand-primary: #3b82f6; --brand-secondary: #93c5fd;
            --shadow-color: rgba(0,0,0,0.25);
        }
        body { font-family: 'Inter', sans-serif; background-color: var(--bg-primary); color: var(--text-primary); transition: background-color 0.3s ease, color 0.3s ease; }
        .nav-link { transition: all 0.3s ease; cursor: pointer; position: relative; padding-bottom: 0.75rem; color: var(--text-secondary); }
        .nav-link.active { color: var(--brand-primary); font-weight: 700; }
        .nav-link.active::after { content: ''; position: absolute; bottom: 0; left: 50%; transform: translateX(-50%); width: 80%; height: 3px; background-color: var(--brand-primary); border-radius: 2px; }
        .chart-container { position: relative; width: 100%; max-width: 400px; margin-left: auto; margin-right: auto; height: 300px; }
        .view.hidden, .detail-view.hidden { display: none; }
        .card { background-color: var(--bg-secondary); border: 1px solid var(--border-primary); box-shadow: 0 4px 10px var(--shadow-color); transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out; border-radius: 1rem; }
        .card:hover { transform: translateY(-5px); box-shadow: 0 10px 20px var(--shadow-color); }
        .task-item { display: flex; align-items: center; justify-content: space-between; background-color: var(--bg-accent); padding: 0.75rem 1rem; border-radius: 0.5rem; margin-bottom: 0.5rem; border: 1px solid var(--border-accent); }
        .task-item.completed { background-color: #d1fae5; color: #065f46; text-decoration: line-through; border-color: #34d399; }
        [data-theme="dark"] .task-item.completed, [data-theme="synthwave"] .task-item.completed { background-color: #065f46; color: #d1fae5; }
        .gradient-button { background-image: linear-gradient(to right, var(--brand-primary) 0%, var(--brand-secondary) 100%); transition: all 0.3s ease; color: white; }
        .gradient-button:hover { background-position: right center; box-shadow: 0 5px 15px var(--shadow-color); }
        .token-display-box { background-color: var(--bg-accent); border: 1px solid var(--border-accent); border-radius: 0.75rem; padding: 0.75rem 1.25rem; display: inline-flex; align-items: center; gap: 0.5rem; font-size: 1.125rem; font-weight: 700; color: var(--text-accent); box-shadow: 0 2px 5px var(--shadow-color); }
        .token-display-box .icon { font-size: 1.5rem; line-height: 1; }
        .journal-card { background-color: var(--bg-secondary); border-left: 4px solid var(--brand-primary); }
        input, select, textarea { background-color: var(--bg-secondary); color: var(--text-primary); border: 1px solid var(--border-primary); }
        input:focus, select:focus, textarea:focus { border-color: var(--brand-primary); box-shadow: 0 0 0 2px var(--brand-primary); outline: none; }
    </style>
</head>
<body>

    <div id="app" class="max-w-7xl mx-auto p-4 md:p-8">

        <!-- Personalization Menu -->
        <section id="personalization-menu" class="view hidden">
             <div class="card p-6 md:p-10 max-w-2xl mx-auto">
                <h2 class="text-3xl font-bold text-center mb-6">üåü Personalize Your Improvement Journey üåü</h2>
                <div class="space-y-6">
                     <div><label for="user-name" class="font-semibold block mb-2">Your Name:</label><input type="text" id="user-name" placeholder="E.g., Alex" class="w-full p-2 rounded-md"></div>
                     <div><label for="difficulty-select" class="font-semibold block mb-2">Difficulty/Intensity:</label><select id="difficulty-select" class="w-full p-2 rounded-md"><option value="casual">Casual</option><option value="normal" selected>Normal</option><option value="intense">Intense</option></select></div>
                     <div><label class="font-semibold block mb-2">Skills To Develop:</label><div id="personalization-skills-grid" class="grid grid-cols-2 md:grid-cols-3 gap-3"></div></div>
                     <button id="start-glow-up-btn" class="w-full gradient-button text-white font-bold py-3 px-6 rounded-lg text-lg">Start Your Journey!</button>
                 </div>
            </div>
        </section>

        <!-- Main App Content -->
        <div id="app-main-content" class="hidden">
            <header class="flex justify-between items-center mb-10">
                <div><h1 class="text-4xl md:text-5xl font-bold">Hello, <span id="display-user-name"></span>!</h1><p class="mt-2 text-lg text-secondary">Your journey to a better you starts now.</p></div>
                <div class="relative">
                    <button id="settings-btn" class="p-3 rounded-full hover:bg-secondary"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path></svg></button>
                    <div id="settings-panel" class="absolute right-0 mt-2 w-56 card p-4 hidden z-20"><h4 class="font-semibold mb-3">Theme</h4><div class="flex justify-around">
                         <button class="theme-btn border-2 border-gray-300 rounded-full w-8 h-8 bg-white" data-theme="light"></button><button class="theme-btn border-2 border-gray-500 rounded-full w-8 h-8 bg-gray-800" data-theme="dark"></button><button class="theme-btn border-2 border-pink-400 rounded-full w-8 h-8 bg-purple-900" data-theme="synthwave"></button><button class="theme-btn border-2 border-green-500 rounded-full w-8 h-8 bg-green-800" data-theme="forest"></button><button class="theme-btn border-2 border-blue-500 rounded-full w-8 h-8 bg-blue-800" data-theme="ocean"></button>
                    </div></div>
                </div>
            </header>

            <nav class="flex justify-center border-b border-border-primary mb-10 space-x-1 sm:space-x-4 text-xs sm:text-base font-semibold">
                <a data-view="dashboard" class="nav-link active py-4 px-2">Dashboard</a><a data-view="plan" class="nav-link py-4 px-2">Plan</a><a data-view="pillars" class="nav-link py-4 px-2">Pillars</a><a data-view="skills" class="nav-link py-4 px-2">Skills</a><a data-view="daily-focus" class="nav-link py-4 px-2">Daily Focus</a><a data-view="goals" class="nav-link py-4 px-2">Goals</a><a data-view="shop" class="nav-link py-4 px-2">Shop</a><a data-view="analytics" class="nav-link py-4 px-2">Analytics</a><a data-view="journal" class="nav-link py-4 px-2">Journal</a><a data-view="leaderboard" class="nav-link py-4 px-2">Leaderboard</a>
            </nav>

            <main>
                <section id="dashboard" class="view"><div class="grid grid-cols-1 md:grid-cols-3 gap-8"><div class="md:col-span-2 card p-6"><div class="flex items-center mb-4"><span id="today-pillar-icon" class="text-3xl mr-3"></span><h3 class="font-bold text-xl">Day <span id="today-day"></span> Mission</h3></div><p id="today-task" class="text-lg text-secondary leading-relaxed mb-6"></p><div class="bg-accent border border-accent p-4 rounded-lg mb-6"><h4 class="font-semibold text-accent mb-2">Daily Affirmation:</h4><p id="daily-affirmation" class="text-accent text-base italic"></p></div><div class="mb-6 grid grid-cols-1 md:grid-cols-2 gap-4"><div><label for="mood-select" class="block font-semibold text-secondary mb-2">Mood:</label><select id="mood-select" class="w-full p-2 rounded-md"><option value="">Select</option><option value="üòÉ">üòÉ Great!</option><option value="üòä">üòä Good</option><option value="üòê">üòê Okay</option><option value="üòî">üòî Down</option><option value="üò°">üò° Frustrated</option></select></div><div><label for="daily-highlight-input" class="block font-semibold text-secondary mb-2">Win/Highlight:</label><input type="text" id="daily-highlight-input" placeholder="What made you smile?" class="w-full p-2 rounded-md"></div></div><div class="flex flex-wrap justify-between items-center mt-6 mb-4 gap-2"><span class="token-display-box text-sm"><span class="icon">üî•</span> Streak: <span id="current-streak-visual"></span></span><span class="token-display-box text-sm"><span class="icon">üèÜ</span> Best: <span id="best-streak">0</span></span><span class="token-display-box text-sm"><span class="icon">üõå</span> Rest Days: <span id="rest-days-display">0</span></span></div><button id="complete-today-btn" class="w-full md:w-auto gradient-button text-white font-bold py-3 px-6 rounded-lg mt-6">Mark as Complete</button></div><div class="space-y-6"><div class="card p-6"><h3 class="font-bold text-xl mb-4">üìä Progress Tracker</h3><div class="chart-container"><canvas id="progressChart"></canvas></div><p id="progress-message" class="text-center mt-4 font-medium text-secondary"></p></div></div></div></section>
                <section id="plan" class="view hidden"><div id="calendar-grid" class="grid grid-cols-3 sm:grid-cols-5 md:grid-cols-7 gap-4"></div></section>
                <section id="pillars" class="view hidden"><div id="pillars-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div></section>
                <section id="pillar-detail-view" class="detail-view hidden card p-6 max-w-4xl mx-auto"></section>
                <section id="skills" class="view hidden"><div id="skills-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div></section>
                <section id="skill-detail-view" class="detail-view hidden card p-6 max-w-4xl mx-auto"></section>
                <section id="daily-focus" class="view hidden card max-w-2xl mx-auto p-6"></section>
                <section id="goals" class="view hidden card max-w-2xl mx-auto p-6"></section>
                <section id="shop" class="view hidden"><div class="text-center mb-8"><h2 class="text-3xl font-bold mb-2">üõçÔ∏è The Shop üõçÔ∏è</h2><div class="flex justify-center mt-4 mb-6"><span class="token-display-box"><span class="icon">‚ú®</span> Your Tokens: <span id="shop-tokens-display">0</span></span></div></div><div id="shop-items-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 max-w-4xl mx-auto"></div></section>
                <section id="analytics" class="view hidden"><div class="text-center mb-8"><h2 class="text-3xl font-bold mb-2">üìà Analytics</h2><p class="text-secondary">A look at your progress.</p></div><div class="grid grid-cols-1 lg:grid-cols-2 gap-8"><div class="card p-6"><h3 class="font-bold text-xl mb-4">Pillar Progress</h3><div class="chart-container h-64 md:h-80"><canvas id="pillarRadarChart"></canvas></div></div><div class="card p-6"><h3 class="font-bold text-xl mb-4">Mood Trend</h3><div class="chart-container h-64 md:h-80"><canvas id="moodTrendChart"></canvas></div></div><div class="lg:col-span-2 card p-6"><h3 class="font-bold text-xl mb-4">Statistics</h3><div id="stats-grid" class="grid grid-cols-2 md:grid-cols-4 gap-4 text-center"></div></div></div></section>
                <section id="journal" class="view hidden"><div class="text-center mb-8"><h2 class="text-3xl font-bold mb-2">üìñ Your Journal</h2><p class="text-secondary">Reflect on your journey.</p></div><div id="journal-entries" class="space-y-6 max-w-3xl mx-auto"></div></section>
                <section id="leaderboard" class="view hidden"><div class="text-center mb-8"><h2 class="text-3xl font-bold mb-2">üèÜ Leaderboard</h2><p class="text-secondary">See how you stack up!</p></div><div id="leaderboard-list" class="space-y-4 max-w-2xl mx-auto"></div></section>
            </main>
        </div>
    </div>

    <div id="task-modal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4 hidden z-50"><div class="card p-8 max-w-md w-full"><h3 class="font-bold text-2xl mb-4">Day <span id="modal-day"></span> Mission</h3><p id="modal-task" class="text-secondary mb-6"></p><button id="close-modal-btn" class="w-full bg-border-primary text-primary font-bold py-2 px-4 rounded-lg">Close</button></div></div>
    <div id="weekly-summary-modal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4 hidden z-50"><div class="card p-8 max-w-lg w-full text-center"><h2 class="text-2xl font-bold mb-4">üéâ Weekly Recap! üéâ</h2><p class="text-secondary mb-6">Here's how you did:</p><div id="weekly-summary-content" class="text-left space-y-3 mb-6"></div><button id="close-summary-modal-btn" class="gradient-button text-white font-bold py-2 px-6 rounded-lg">Keep Going!</button></div></div>
    <div id="message-box" class="fixed bottom-5 right-5 bg-green-500 text-white py-3 px-5 rounded-lg shadow-xl transform translate-y-20 opacity-0 transition-all duration-500 z-50"></div>

    <script>
        const AppState = { currentView: 'dashboard', theme: 'light', userName: null, selectedSkills: new Set(), isPersonalized: false, today: 1, completedDays: new Set(), currentStreak: 0, bestStreak: 0, dailyActivityMap: {}, completedSkillTasks: {}, completedPillarTasks: {}, tokens: 0, dailyFocusTasks: [], dailyFocusCompletedToday: false, lastDailyFocusDate: null, restDaysAvailable: 0, userGoals: {}, globalGoals: [], startDate: null, lastVisitDate: null, lastWeeklySummaryDay: 0 };
        const dailyTasks = Array.from({ length: 90 }, (_, i) => ({ day: i + 1, pillar: ['Mind', 'Body', 'Skin', 'Nourish', 'Hygiene', 'Style'][i % 6], task: i==0 ? "Goal Setting & Hydration" : (i==89 ? "Final Celebration!" : `Focus on pillar.`) }));
        const pillarsData = [ { id: 'nourish', icon: 'üçé', title: 'Nourish', content: "Fuel your body.", tasks: ["Drink 8 glasses of water.", "Eat 2 servings of fruit.", "Include a vegetable in lunch."]}, { id: 'body', icon: 'üí™', title: 'Body', content: "Get stronger.", tasks: ["Go for a 20-minute walk.", "Do 3 sets of 10 squats.", "Hold a plank for 30s."]}, { id: 'skin', icon: '‚ú®', title: 'Skin', content: "Achieve clean skin.", tasks: ["Wash face morning & night.", "Apply moisturizer.", "Wear a cap in the sun."]}, { id: 'hygiene', icon: 'üíß', title: 'Hygiene', content: "Feel and smell fresh.", tasks: ["Take a refreshing shower.", "Brush teeth twice.", "Wear clean clothes."]}, { id: 'mind', icon: 'üß†', title: 'Mind', content: "Stay mindful.", tasks: ["Organize study space.", "Use Pomodoro Technique.", "Practice 5-min mindfulness."]}, { id: 'style', icon: 'üëï', title: 'Style', content: "Express yourself.", tasks: ["Choose outfit for tomorrow.", "Practice good posture.", "Organize a closet section."]} ];
        const skillsData = [ { id: 'coding', icon: 'üíª', title: 'Coding', content: 'Learn coding fundamentals.', tasks: ["Complete 'Hello World'.", "Learn 3 HTML tags.", "Practice touch typing."]}, { id: 'singing', icon: 'üé§', title: 'Singing', content: 'Develop vocal abilities.', tasks: ["Practice a vocal warm-up.", "Sing a favorite song.", "Match a simple pitch."]}, { id: 'writing', icon: 'üìù', title: 'Writing', content: 'Improve communication.', tasks: ["Write a journal entry.", "Describe favorite food.", "Write a thank-you note."]}, { id: 'leadership', icon: 'ü§ù', title: 'Leadership', content: 'Develop skills to guide.', tasks: ["Take initiative.", "Practice active listening.", "Encourage someone."]}, { id: 'problem-solving', icon: 'ü§î', title: 'Problem Solving', content: 'Enhance analytical skills.', tasks: ["Solve a logic puzzle.", "Break task into steps.", "Think of alternative use for an object."]}, { id: 'cooking-baking', icon: 'üç≥', title: 'Cooking', content: 'Develop culinary skills.', tasks: ["Make a simple sandwich.", "Learn to cook pasta.", "Bake simple cookies."]} ];
        const shopItems = [ { id: 'rest-day', name: 'Rest Day', icon: 'üõå', description: 'Skip one daily mission!', cost: 20 }, { id: 'instant-tip', name: 'Instant Tip', icon: 'üí°', description: 'Get a motivational tip!', cost: 8 }, { id: 'token-bonus', name: 'Token Bonus', icon: '‚ú®', description: 'Get 5 extra Tokens!', cost: 15 } ];
        let progressChart, pillarChart, moodChart;

        function saveState() { const s={...AppState, completedDays: [...AppState.completedDays], selectedSkills: [...AppState.selectedSkills]}; localStorage.setItem('improvementHubState_v3', JSON.stringify(s)); }
        function loadState() { const s=localStorage.getItem('improvementHubState_v3'); if(s){const p=JSON.parse(s); Object.assign(AppState, p); AppState.completedDays=new Set(p.completedDays||[]); AppState.selectedSkills=new Set(p.selectedSkills||[]); AppState.startDate=p.startDate?new Date(p.startDate):null;} const t=new Date(); t.setHours(0,0,0,0); if(!AppState.startDate)AppState.startDate=t; AppState.today=Math.floor((t-AppState.startDate)/(1000*60*60*24))+1; const f=formatDate(t); if(AppState.lastVisitDate!==f){const y=new Date(t.getTime()-(864e5)); const a=AppState.dailyActivityMap[formatDate(y)]; if(AppState.today>1&&(!a||!a.main))AppState.currentStreak=0; AppState.lastVisitDate=f; AppState.dailyFocusCompletedToday=false; AppState.dailyFocusTasks=[]; checkAndShowWeeklySummary();} saveState(); }
        function formatDate(d){return d.toISOString().split('T')[0];}
        function showMessage(t, success=true){const m=document.getElementById('message-box'); m.textContent=t; m.style.backgroundColor = success ? 'var(--brand-primary)' : '#ef4444'; m.classList.remove('opacity-0','translate-y-20'); setTimeout(()=>m.classList.add('opacity-0','translate-y-20'),3000);}
        function applyTheme(t){document.documentElement.setAttribute('data-theme',t); AppState.theme=t; saveState(); if(AppState.isPersonalized)updateView(AppState.currentView);}
        function updateView(vId){document.querySelectorAll('.view, .detail-view').forEach(v=>v.classList.add('hidden')); document.querySelectorAll('.nav-link').forEach(l=>l.classList.remove('active')); const v=document.getElementById(vId); const l=document.querySelector(`.nav-link[data-view="${vId}"]`); if(v)v.classList.remove('hidden'); if(l)l.classList.add('active'); AppState.currentView=vId; saveState(); const renders={'dashboard':renderDashboard, 'plan':renderCalendar, 'pillars':renderPillars, 'skills':renderSkills, 'daily-focus':renderDailyFocus, 'goals':renderGlobalGoals, 'shop':renderShop, 'analytics':renderAnalytics, 'journal':renderJournal, 'leaderboard':renderLeaderboard}; if(renders[vId])renders[vId]();}
        
        function renderDashboard(){document.getElementById('display-user-name').textContent=AppState.userName||'User'; const today=dailyTasks.find(t=>t.day===AppState.today)||dailyTasks[89]; document.getElementById('today-day').textContent=AppState.today; document.getElementById('today-task').textContent=today.task; document.getElementById('today-pillar-icon').textContent = pillarsData.find(p=>p.title===today.pillar)?.icon || 'üß†'; document.getElementById('best-streak').textContent=AppState.bestStreak; document.getElementById('rest-days-display').textContent=AppState.restDaysAvailable; document.getElementById('current-streak-visual').textContent=AppState.currentStreak; const btn=document.getElementById('complete-today-btn'); btn.disabled=AppState.completedDays.has(AppState.today); btn.textContent=btn.disabled?'Completed!':'Mark as Complete'; const todayF=formatDate(new Date()); let act=AppState.dailyActivityMap[todayF]||{}; document.getElementById('mood-select').value=act.mood||''; document.getElementById('daily-highlight-input').value=act.highlight||''; renderProgressChart();}
        function renderProgressChart(){const c=document.getElementById('progressChart')?.getContext('2d'); if(!c)return; if(progressChart)progressChart.destroy(); progressChart=new Chart(c,{type:'doughnut',data:{labels:['Completed','Remaining'],datasets:[{data:[AppState.completedDays.size,90-AppState.completedDays.size],backgroundColor:['var(--brand-primary)','var(--border-primary)'],borderColor:'var(--bg-secondary)',borderWidth:4}]},options:{responsive:true,maintainAspectRatio:false,cutout:'70%',plugins:{legend:{display:false}}}}); document.getElementById('progress-message').textContent=`${AppState.completedDays.size} of 90 days complete.`}
        function renderCalendar(){const g=document.getElementById('calendar-grid'); g.innerHTML=''; dailyTasks.forEach(t=>{const e=document.createElement('div'); e.dataset.day=t.day; e.className='h-20 flex items-center justify-center font-bold text-xl rounded-lg cursor-pointer transition-all border'; e.textContent=t.day; if(AppState.completedDays.has(t.day))e.classList.add('bg-green-200','border-green-400'); else if(t.day<AppState.today)e.classList.add('bg-red-200','border-red-400'); else e.classList.add('bg-secondary','border-primary'); if(t.day===AppState.today)e.classList.add('ring-2','ring-brand-primary'); e.addEventListener('click',()=>showModalForDay(t.day)); g.appendChild(e);});}
        function renderPillars(){const g=document.getElementById('pillars-grid'); g.innerHTML=''; pillarsData.forEach(p=>{const c=document.createElement('div'); c.className='card p-6 cursor-pointer'; c.innerHTML=`<div class="flex items-center"><span class="text-3xl mr-4">${p.icon}</span><h4 class="font-bold text-xl">${p.title}</h4></div>`; c.onclick=()=>showDetail('pillar',p.id); g.appendChild(c);});}
        function renderSkills(){const g=document.getElementById('skills-grid'); g.innerHTML=''; skillsData.forEach(s=>{const c=document.createElement('div'); c.className='card p-6 cursor-pointer'; c.innerHTML=`<div class="flex items-center"><span class="text-3xl mr-4">${s.icon}</span><h4 class="font-bold text-xl">${s.title}</h4></div>`; c.onclick=()=>showDetail('skill',s.id); g.appendChild(c);});}
        function showDetail(type, id){ const isPillar=type==='pillar'; const data=isPillar?pillarsData.find(p=>p.id===id):skillsData.find(s=>s.id===id); const viewId=isPillar?'pillar-detail-view':'skill-detail-view'; const mainViewId=isPillar?'pillars':'skills'; document.getElementById(mainViewId).classList.add('hidden'); const dV=document.getElementById(viewId); dV.classList.remove('hidden'); const completedTasks=isPillar?AppState.completedPillarTasks[id]||[]:AppState.completedSkillTasks[id]||[]; const progress=data.tasks.length>0?Math.round((completedTasks.length/data.tasks.length)*100):0; dV.innerHTML=`<button class="font-semibold text-brand-primary mb-6" onclick="updateView('${mainViewId}')">‚Üê Back</button><div class="flex items-center mb-4"><span class="text-4xl mr-4">${data.icon}</span><h3 class="font-bold text-2xl">${data.title}</h3></div><p class="text-secondary mb-6">${data.content}</p><h4 class="font-semibold text-xl mb-3">Actionable Steps:</h4><div class="space-y-2 mb-6">${data.tasks.map((t,i)=>`<div class="task-item ${completedTasks.includes(i)?'completed':''}"><span class="${completedTasks.includes(i)?'':'text-primary'}">${t}</span><button onclick="completeTask('${type}', '${id}', ${i})" class="gradient-button text-sm px-2 py-1 rounded" ${completedTasks.includes(i)?'disabled':''}>${completedTasks.includes(i)?'Done':'Mark Done'}</button></div>`).join('')}</div><p class="text-sm font-medium">Progress: <span class="font-bold text-brand-primary">${progress}%</span></p><div class="w-full bg-border-primary rounded-full h-2.5 mt-2"><div class="bg-brand-primary h-2.5 rounded-full" style="width: ${progress}%"></div></div>`;}
        function completeTask(type, id, index){const list=type==='pillar'?AppState.completedPillarTasks:AppState.completedSkillTasks; if(!list[id])list[id]=[]; if(!list[id].includes(index)){list[id].push(index); saveState(); showDetail(type,id); showMessage('Task Completed!');}}
        function renderDailyFocus(){const c=document.getElementById('daily-focus'); if(!AppState.dailyFocusTasks.length){const s_ids=AppState.selectedSkills.size>0?[...AppState.selectedSkills]:skillsData.map(s=>s.id); const allTasks=[]; s_ids.forEach(s_id=>{const s=skillsData.find(s=>s.id===s_id); s.tasks.forEach((t,i)=>allTasks.push({skillId:s_id,taskIndex:i,taskText:t}));}); AppState.dailyFocusTasks=allTasks.sort(()=>0.5-Math.random()).slice(0,3).map(t=>({...t,completed:false})); saveState();} c.innerHTML=`<div class="text-center mb-6"><h2 class="text-2xl font-bold">üéØ Daily Skill Focus</h2><p class="text-secondary">Complete these for tokens!</p><div class="token-display-box my-4"><span class="icon">‚ú®</span> Tokens: ${AppState.tokens}</div></div><div class="space-y-3 mb-6">${AppState.dailyFocusTasks.map((t,i)=>`<div class="task-item ${t.completed?'completed':''}"><label class="flex items-center w-full"><input type="checkbox" onchange="toggleDailyTask(${i})" class="mr-3 h-5 w-5 accent-brand-primary" ${t.completed?'checked':''}><span>${skillsData.find(s=>s.id===t.skillId)?.icon||''} ${t.taskText}</span></label></div>`).join('')}</div><button id="claim-tokens-btn" onclick="claimTokens()" class="w-full gradient-button py-3 rounded-lg" ${AppState.dailyFocusTasks.every(t=>t.completed)&&!AppState.dailyFocusCompletedToday?'':'disabled'}>${AppState.dailyFocusCompletedToday?'Claimed!':'Claim Tokens'}</button>`;}
        function toggleDailyTask(i){AppState.dailyFocusTasks[i].completed=!AppState.dailyFocusTasks[i].completed; saveState(); renderDailyFocus();}
        function claimTokens(){if(AppState.dailyFocusTasks.every(t=>t.completed)&&!AppState.dailyFocusCompletedToday){AppState.tokens+=3; AppState.dailyFocusCompletedToday=true; const f=formatDate(new Date()); AppState.dailyActivityMap[f]={...AppState.dailyActivityMap[f],focus:true}; saveState(); renderDailyFocus(); showMessage('3 Tokens Claimed! ‚ú®');}else showMessage('Complete all tasks first!',false);}
        function renderGlobalGoals(){const c=document.getElementById('goals'); c.innerHTML=`<div class="text-center mb-6"><h2 class="text-2xl font-bold">üåü Personal Goals</h2></div><div id="global-goals-list" class="space-y-2 mb-4">${AppState.globalGoals.map((g,i)=>`<div class="task-item ${g.completed?'completed':''}"><label class="flex items-center w-full"><input type="checkbox" onchange="toggleGlobalGoal(${i})" class="mr-3 h-5 w-5 accent-brand-primary" ${g.completed?'checked':''}><span>${g.text}</span></label></div>`).join('')||'<p class="text-secondary text-center">No goals yet.</p>'}</div><div class="flex mt-4"><input type="text" id="add-global-goal-input" class="w-full p-2 rounded-md mr-2" placeholder="Add a new goal..."><button onclick="addGlobalGoal()" class="gradient-button px-4 rounded-md">Add</button></div>`;}
        function addGlobalGoal(){const i=document.getElementById('add-global-goal-input'); const t=i.value.trim(); if(t){AppState.globalGoals.push({text:t,completed:false}); i.value=''; saveState(); renderGlobalGoals();}}
        function toggleGlobalGoal(i){AppState.globalGoals[i].completed=!AppState.globalGoals[i].completed; saveState(); renderGlobalGoals();}
        function renderShop(){const g=document.getElementById('shop-items-grid'); g.innerHTML=''; shopItems.forEach(i=>{const c=document.createElement('div'); c.className='card p-6'; const canAfford=AppState.tokens>=i.cost; c.innerHTML=`<div class="flex items-center mb-3"><span class="text-3xl mr-4">${i.icon}</span><h4 class="font-bold text-xl">${i.name}</h4></div><p class="text-secondary mb-4 h-12">${i.description}</p><div class="flex items-center justify-between"><span class="font-bold text-lg text-brand-primary">${i.cost} ‚ú®</span><button onclick="buyItem('${i.id}')" class="px-4 py-2 rounded-md text-sm font-semibold ${canAfford?'gradient-button text-white':'bg-gray-200 text-gray-500 cursor-not-allowed'}" ${canAfford?'':'disabled'}>Buy</button></div>`; g.appendChild(c);}); document.getElementById('shop-tokens-display').textContent=AppState.tokens;}
        function buyItem(id){const item=shopItems.find(i=>i.id===id); if(AppState.tokens>=item.cost){AppState.tokens-=item.cost; if(id==='rest-day')AppState.restDaysAvailable++; if(id==='token-bonus')AppState.tokens+=5; if(id==='instant-tip')showMessage('Tip: Consistency is key!'); saveState(); renderShop(); renderDashboard(); showMessage(`Purchased ${item.name}!`);}else showMessage('Not enough tokens!',false);}
        function renderAnalytics(){renderPillarRadarChart();renderMoodTrendChart();renderStats();}
        function renderPillarRadarChart(){const c=document.getElementById('pillarRadarChart')?.getContext('2d');if(!c)return;const d={labels:pillarsData.map(p=>p.title),datasets:[{label:'Pillar Progress',data:pillarsData.map(p=>(AppState.completedPillarTasks[p.id]?.length||0)/(p.tasks.length||1)*100),backgroundColor:'rgba(245,158,11,0.2)',borderColor:'var(--brand-primary)',borderWidth:2}]};if(pillarChart)pillarChart.destroy();pillarChart=new Chart(c,{type:'radar',data:d,options:{responsive:true,maintainAspectRatio:false,scales:{r:{angleLines:{color:'var(--border-primary)'},grid:{color:'var(--border-primary)'},pointLabels:{color:'var(--text-primary)'},ticks:{display:false}}}}});}
        function renderMoodTrendChart(){const c=document.getElementById('moodTrendChart')?.getContext('2d');if(!c)return;const m={'üòÉ':5,'üòä':4,'üòê':3,'üòî':2,'üò°':1};const l=Object.entries(AppState.dailyActivityMap).sort((a,b)=>new Date(a[0])-new Date(b[0])).slice(-14);const d={labels:l.map(e=>new Date(e[0]).toLocaleDateString(undefined,{month:'short',day:'numeric'})),datasets:[{label:'Mood',data:l.map(e=>m[e[1].mood]||null),borderColor:'var(--brand-primary)',tension:0.3,spanGaps:true}]};if(moodChart)moodChart.destroy();moodChart=new Chart(c,{type:'line',data:d,options:{responsive:true,maintainAspectRatio:false,scales:{y:{min:1,max:5,ticks:{stepSize:1,color:'var(--text-secondary)',callback:v=>Object.keys(m).find(k=>m[k]===v)||''}},x:{ticks:{color:'var(--text-secondary)'}}},plugins:{legend:{display:false}}}});}
        function renderStats(){const c=document.getElementById('stats-grid');if(!c)return;const p=Object.values(AppState.completedPillarTasks).flat().length;const k=Object.values(AppState.completedSkillTasks).flat().length;const g=Object.values(AppState.userGoals).flat().filter(g=>g.completed).length+AppState.globalGoals.filter(g=>g.completed).length;const s=[{l:"Days Complete",v:AppState.completedDays.size},{l:"Pillar Tasks",v:p},{l:"Skill Tasks",v:k},{l:"Goals Met",v:g}];c.innerHTML=s.map(t=>`<div><p class="text-3xl font-bold text-brand-primary">${t.v}</p><p class="text-secondary">${t.l}</p></div>`).join('')}
        function renderJournal(){const c=document.getElementById('journal-entries');c.innerHTML='';const e=Object.entries(AppState.dailyActivityMap).filter(([d,t])=>t.highlight||t.mood).sort((a,b)=>new Date(b[0])-new Date(a[0]));if(e.length===0){c.innerHTML=`<div class="card p-6 text-center text-secondary">No entries yet.</div>`;return}e.forEach(([d,t])=>{const o=new Date(d);const n=Math.floor((o-AppState.startDate)/864e5)+1;c.innerHTML+=`<div class="journal-card p-4 rounded-lg shadow-md"><div class="flex justify-between items-start"><div><p class="font-bold text-lg">Day ${n}</p><p class="text-sm text-secondary">${o.toLocaleDateString(undefined,{weekday:'long',month:'long',day:'numeric'})}</p></div>${t.mood?`<p class="text-3xl">${t.mood}</p>`:''}${t.highlight?`<p class="mt-4 italic">"${t.highlight}"</p>`:''}`});}
        function renderLeaderboard(){const c=document.getElementById('leaderboard-list');const u=[{name:AppState.userName||'You',score:AppState.tokens+AppState.completedDays.size*5+AppState.currentStreak*2,isCurrentUser:true},{name:'Alex R.',score:150},{name:'Jamie L.',score:135},{name:'Sam K.',score:110},{name:'Chris P.',score:95}].sort((a,b)=>b.score-a.score);c.innerHTML=u.map((user,i)=>`<div class="card flex items-center p-4 ${user.isCurrentUser?'border-2 border-brand-primary':''}"><span class="text-xl font-bold w-10 text-secondary">${i+1}</span><span class="flex-grow font-semibold">${user.name}</span><span class="font-bold text-brand-primary">${user.score} pts</span></div>`).join('');}
        function checkAndShowWeeklySummary(){const w=Math.floor((AppState.today-1)/7);const l=Math.floor((AppState.lastWeeklySummaryDay-1)/7);if(AppState.today>1&&w>l){const c=document.getElementById('weekly-summary-content');let d=0;for(let i=w*7+1;i<=w*7+7;i++)if(AppState.completedDays.has(i))d++;c.innerHTML=`<p><strong>Days Completed:</strong> ${d}/7</p>`;document.getElementById('weekly-summary-modal').classList.remove('hidden');AppState.lastWeeklySummaryDay=AppState.today;saveState();}}
        function showModalForDay(day){const task=dailyTasks.find(t=>t.day==day); if(task){document.getElementById('modal-day').textContent=task.day;document.getElementById('modal-task').textContent=task.task;document.getElementById('task-modal').classList.remove('hidden');}}
        
        document.addEventListener('DOMContentLoaded', () => {
            loadState();
            if(!AppState.isPersonalized){document.getElementById('personalization-menu').classList.remove('hidden');const s=document.getElementById('personalization-skills-grid');skillsData.forEach(k=>s.innerHTML+=`<label class="flex items-center space-x-2 card p-2 rounded-md cursor-pointer hover:bg-accent"><input type="checkbox" data-skill-id="${k.id}">${k.icon}<span>${k.title}</span></label>`);}
            else{document.getElementById('app-main-content').classList.remove('hidden'); applyTheme(AppState.theme); updateView(AppState.currentView);}
            const sB=document.getElementById('settings-btn'), sP=document.getElementById('settings-panel'); sB.addEventListener('click',()=>sP.classList.toggle('hidden')); document.querySelectorAll('.theme-btn').forEach(b=>b.addEventListener('click',()=>applyTheme(b.dataset.theme)));
            document.getElementById('start-glow-up-btn').addEventListener('click',()=>{AppState.isPersonalized=true;AppState.userName=document.getElementById('user-name').value.trim()||'User';document.querySelectorAll('#personalization-skills-grid input:checked').forEach(i=>AppState.selectedSkills.add(i.dataset.skillId));document.getElementById('personalization-menu').classList.add('hidden');document.getElementById('app-main-content').classList.remove('hidden');applyTheme(AppState.theme);updateView('dashboard');showMessage(`Welcome, ${AppState.userName}!`)})
            document.querySelector('nav').addEventListener('click',e=>{if(e.target.matches('.nav-link'))updateView(e.target.dataset.view)});
            document.getElementById('complete-today-btn').addEventListener('click',()=>{if(AppState.completedDays.has(AppState.today)){showMessage("Already completed!",false);return}AppState.completedDays.add(AppState.today);AppState.currentStreak++;if(AppState.currentStreak>AppState.bestStreak)AppState.bestStreak=AppState.currentStreak;const t=formatDate(new Date());AppState.dailyActivityMap[t]={...AppState.dailyActivityMap[t],main:true,mood:document.getElementById('mood-select').value,highlight:document.getElementById('daily-highlight-input').value.trim()};saveState();renderDashboard();renderCalendar();showMessage("Great job! Mission complete!");checkAndShowWeeklySummary()});
            ['mood-select','daily-highlight-input'].forEach(id=>document.getElementById(id).addEventListener('input',e=>{const t=formatDate(new Date());const p=id==='mood-select'?'mood':'highlight';AppState.dailyActivityMap[t]={...AppState.dailyActivityMap[t],[p]:e.target.value};saveState()}));
            document.getElementById('close-summary-modal-btn').addEventListener('click',()=>document.getElementById('weekly-summary-modal').classList.add('hidden'));
            document.getElementById('close-modal-btn').addEventListener('click', ()=>document.getElementById('task-modal').classList.add('hidden'));
        });
    </script>
</body>
</html>
